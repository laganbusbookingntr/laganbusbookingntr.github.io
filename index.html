<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lagan Bus Booking</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
    body{background:linear-gradient(135deg,#e0f7fa,#f3e5f5);padding:20px;min-height:100vh}
    h1{text-align:center;color:#0d47a1;font-size:2.2rem;font-weight:800;margin-bottom:10px}
    .subtitle{text-align:center;color:#546e7a;margin-bottom:15px}
    .contact-info{background:#0d47a1;color:#fff;display:inline-block;padding:10px 20px;border-radius:50px;margin:0 auto 20px;display:flex;align-items:center;gap:10px;justify-content:center}

    .container,.admin-login-container,.admin-panel,.passenger-details{
      background:rgba(255,255,255,0.9);backdrop-filter:blur(10px);
      border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.2);
      padding:25px;margin:20px auto;max-width:500px
    }
    input,select{width:100%;padding:12px;border:2px solid #e0f2f1;border-radius:12px;margin:8px 0}
    input:focus,select:focus{border-color:#0d47a1;outline:none;box-shadow:0 0 0 3px rgba(13,71,161,0.15)}

    button{border:none;border-radius:50px;padding:10px 20px;font-weight:600;cursor:pointer;transition:.3s;display:inline-flex;align-items:center;gap:6px}
    .btn-main{background:linear-gradient(135deg,#0d47a1,#1976d2);color:#fff}
    .btn-main:hover{box-shadow:0 6px 15px rgba(0,0,0,0.3);transform:translateY(-2px)}
    .btn-ghost{background:transparent;border:2px solid #0d47a1;color:#0d47a1}
    .btn-ghost:hover{background:#e3f2fd}
    .logout-btn{background:linear-gradient(135deg,#c62828,#d32f2f);color:#fff}

    .greet{text-align:center;font-size:20px;font-weight:600;color:#0d47a1;margin-bottom:20px}
    .bus-card{background:#fff;padding:20px;border-radius:15px;margin-bottom:20px;box-shadow:0 4px 12px rgba(0,0,0,0.1);text-align:center}
    .bus-image img{max-width:100%;max-height:160px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.2)}
    .bus-name{font-size:20px;font-weight:700;color:#0d47a1;margin-top:10px}
    .bus-time{color:#555;margin-bottom:10px}
    .seat-circles{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:10px 0}
    .seat-circle{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#0d47a1,#1976d2);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;box-shadow:0 4px 10px rgba(13,71,161,0.3)}
    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .info-item{background:#f5f9ff;padding:10px;border-radius:12px}
    .info-label{font-size:12px;font-weight:600;color:#546e7a;text-transform:uppercase}
    .info-value{font-size:14px;font-weight:700;color:#0d47a1}

    .passengers-table{width:100%;border-collapse:collapse;margin-top:20px}
    .passengers-table th,.passengers-table td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
    .passengers-table th{background:#f5f5f5;color:#00695c}
    .passengers-table tr:hover{background:#e0f2f1}
    .action-btn{padding:6px 10px;border-radius:8px;font-size:12px;cursor:pointer}
    .edit-btn{background:#ffca28}
    .delete-btn{background:#d32f2f;color:#fff}
  </style>
</head>
<body>
  <h1><i class="fas fa-bus"></i> Lagan Bus Booking</h1>
  <p class="subtitle">Your journey, our priority</p>
  <div class="contact-info"><i class="fas fa-phone"></i> Reservations: <b>0777 402 886</b></div>

  <!-- Passenger Search -->
  <div class="container" id="container">
    <form id="passenger-form">
      <h2><i class="fas fa-users"></i> Passenger Access</h2>
      <p>Enter your contact number to view bookings</p>
      <input type="tel" id="passenger-contact" placeholder="Your Phone Number" required />
      <button class="btn-main" type="submit"><i class="fas fa-search"></i> Find My Bookings</button>
    </form>
  </div>

  <!-- Passenger Bookings -->
  <div class="passenger-details" id="passenger-details" style="display:none"></div>

  <!-- Admin Login -->
  <div class="admin-login-container" id="admin-login-container" style="display:none">
    <h2><i class="fas fa-lock"></i> Admin Login</h2>
    <input type="password" id="admin-password" placeholder="Admin Password" required />
    <button class="btn-main" id="admin-login-btn">Login</button>
    <button class="btn-ghost" id="admin-login-cancel">Cancel</button>
    <div id="admin-login-error" style="display:none;color:red;margin-top:10px">Incorrect password</div>
  </div>

  <!-- Admin Panel -->
  <div class="admin-panel" id="admin-panel" style="display:none;max-width:1000px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2 style="color:#00695c"><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
      <button class="logout-btn" id="admin-logout">Logout</button>
    </div>
    <hr/>
    <h3 style="color:#00695c"><i class="fas fa-user-plus"></i> Add / Edit Passenger</h3>
    <div>
      <input type="text" id="p-name" placeholder="Name *"/>
      <input type="tel" id="p-contact" placeholder="Contact *"/>
      <input type="text" id="p-bus" placeholder="Bus *"/>
      <input type="time" id="p-time" value="20:30"/>
      <input type="date" id="p-date"/>
      <input type="text" id="p-seat" placeholder="Seat * (e.g. 12,13)"/>
      <input type="text" id="p-pickup" placeholder="Pickup"/>
      <select id="p-payment"><option>Paid</option><option>Pending</option><option>Cancelled</option></select>
      <button class="btn-main" id="save-passenger">Save</button>
      <button class="btn-ghost" id="cancel-edit" style="display:none">Cancel</button>
    </div>
    <table class="passengers-table"><thead>
      <tr><th>Name</th><th>Contact</th><th>Bus</th><th>Time</th><th>Date</th><th>Seat</th><th>Actions</th></tr>
    </thead><tbody id="passengers-list"></tbody></table>
  </div>

  <!-- Admin Access Button -->
  <button class="btn-main" style="position:fixed;bottom:20px;right:20px" id="admin-access-btn"><i class="fas fa-user-shield"></i> Admin</button>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyOANMLQ4CzvHodoI_P1U--WykJOtuFS1Y5mg66J8-kx9rcSWkKUq6oYUUGITwILBl8Ag/exec"; // Replace with Apps Script URL

// ========== Passenger Search ==========
document.getElementById("passenger-form").addEventListener("submit", e=>{
  e.preventDefault();
  const contact=document.getElementById("passenger-contact").value.trim();
  fetch(scriptURL+"?action=getPassenger&contact="+contact)
    .then(r=>r.json())
    .then(d=>{
      if(d.success && d.bookings.length>0){showBookings(d.bookings)}
      else{Swal.fire("No Bookings","No bookings found.","info")}
    });
});

function showBookings(bookings){
  const pd=document.getElementById("passenger-details");
  pd.innerHTML=`<div class="greet">Hi, ${bookings[0].name} ðŸ‘‹</div>`;
  bookings.forEach(b=>{
    let seats=b.seat.split(",").map(s=>s.trim());
    let seatHTML=seats.map(s=>`<div class="seat-circle">${s}</div>`).join("");
    pd.innerHTML+=`
      <div class="bus-card">
        <div class="bus-image"><img src="https://images.unsplash.com/photo-1502920917128-1aa500764cbd?w=600" alt="${b.bus}"></div>
        <div class="bus-name">${b.bus}</div>
        <div class="bus-time">${b.time} | ${b.date}</div>
        <div class="seat-circles">${seatHTML}</div>
        <div class="info-grid">
          <div class="info-item"><div class="info-label">Contact</div><div class="info-value">${b.contact}</div></div>
          <div class="info-item"><div class="info-label">Pickup</div><div class="info-value">${b.pickup||"N/A"}</div></div>
          <div class="info-item"><div class="info-label">Payment</div><div class="info-value">${b.payment}</div></div>
        </div>
      </div>`;
  });
  pd.style.display="block";document.getElementById("container").style.display="none";
}

// ========== Admin Login ==========
const adminBtn=document.getElementById("admin-access-btn");
const adminLogin=document.getElementById("admin-login-container");
const adminPanel=document.getElementById("admin-panel");
adminBtn.addEventListener("click",()=>{adminLogin.style.display="block";document.getElementById("container").style.display="none";});
document.getElementById("admin-login-btn").addEventListener("click",()=>{
  if(document.getElementById("admin-password").value==="admin123"){
    adminLogin.style.display="none";adminPanel.style.display="block";loadPassengers();
  }else{
    document.getElementById("admin-login-error").style.display="block";
    setTimeout(()=>{document.getElementById("admin-login-error").style.display="none"},2000);
  }
});
document.getElementById("admin-login-cancel").addEventListener("click",()=>{adminLogin.style.display="none";document.getElementById("container").style.display="block";});
document.getElementById("admin-logout").addEventListener("click",()=>{adminPanel.style.display="none";document.getElementById("container").style.display="block";});

// ========== Admin CRUD ==========
function loadPassengers(){
  fetch(scriptURL+"?action=getAll").then(r=>r.json()).then(d=>{
    if(d.success){displayPassengers(d.passengers)}
  });
}
function displayPassengers(passengers){
  const tbody=document.getElementById("passengers-list");
  tbody.innerHTML="";
  passengers.forEach(p=>{
    tbody.innerHTML+=`
      <tr>
        <td>${p.name}</td><td>${p.contact}</td><td>${p.bus}</td>
        <td>${p.time}</td><td>${p.date}</td><td>${p.seat}</td>
        <td>
          <button class="action-btn edit-btn" onclick="editPassenger('${p.id}')">Edit</button>
          <button class="action-btn delete-btn" onclick="deletePassenger('${p.id}')">Delete</button>
        </td>
      </tr>`;
  });
  window._passengers=passengers; // store global
}
function editPassenger(id){
  const p=window._passengers.find(x=>String(x.id)===String(id));
  if(p){
    document.getElementById("p-name").value=p.name;
    document.getElementById("p-contact").value=p.contact;
    document.getElementById("p-bus").value=p.bus;
    document.getElementById("p-time").value=p.time;
    document.getElementById("p-date").value=p.date;
    document.getElementById("p-seat").value=p.seat;
    document.getElementById("p-pickup").value=p.pickup;
    document.getElementById("p-payment").value=p.payment;
    document.getElementById("save-passenger").setAttribute("data-id",p.id);
    document.getElementById("cancel-edit").style.display="inline-block";
  }
}
document.getElementById("cancel-edit").addEventListener("click",()=>{resetForm();});
function resetForm(){
  document.querySelectorAll("#p-name,#p-contact,#p-bus,#p-time,#p-date,#p-seat,#p-pickup").forEach(el=>el.value="");
  document.getElementById("p-payment").value="Paid";
  document.getElementById("save-passenger").removeAttribute("data-id");
  document.getElementById("cancel-edit").style.display="none";
}
document.getElementById("save-passenger").addEventListener("click",()=>{
  const data={
    name:document.getElementById("p-name").value.trim(),
    contact:document.getElementById("p-contact").value.trim(),
    bus:document.getElementById("p-bus").value.trim(),
    time:document.getElementById("p-time").value,
    date:document.getElementById("p-date").value,
    seat:document.getElementById("p-seat").value.trim(),
    pickup:document.getElementById("p-pickup").value.trim(),
    payment:document.getElementById("p-payment").value
  };
  if(!data.name||!data.contact||!data.bus||!data.time||!data.date||!data.seat){Swal.fire("Error","Fill required fields","error");return;}
  const isEdit=document.getElementById("save-passenger").hasAttribute("data-id");
  if(isEdit){data.id=document.getElementById("save-passenger").getAttribute("data-id");data.action="update";}
  else{data.action="create";}
  fetch(scriptURL,{method:"POST",body:JSON.stringify(data)}).then(r=>r.json()).then(d=>{
    if(d.success){Swal.fire("Success","Saved successfully!","success");resetForm();loadPassengers();}
    else{Swal.fire("Error","Failed to save","error")}
  });
});
function deletePassenger(id){
  Swal.fire({title:"Delete?",icon:"warning",showCancelButton:true}).then(res=>{
    if(res.isConfirmed){
      fetch(scriptURL,{method:"POST",body:JSON.stringify({action:"delete",id:id})}).then(r=>r.json()).then(d=>{
        if(d.success){Swal.fire("Deleted!","","success");loadPassengers();}
        else{Swal.fire("Error","Failed to delete","error")}
      });
    }
  });
}
</script>
</body>
</html>

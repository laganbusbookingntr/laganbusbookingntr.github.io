<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lagan Bus Booking</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body{font-family:Poppins,sans-serif;background:linear-gradient(135deg,#e0f7fa,#f3e5f5);margin:0;padding:20px}
    h1{text-align:center;color:#0d47a1;margin-bottom:5px}
    p.subtitle{text-align:center;color:#546e7a;margin-bottom:20px}
    .card{background:#fff;border-radius:15px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,0.15);margin:15px auto;max-width:500px}
    input,select{width:100%;padding:12px;margin:8px 0;border:1px solid #ccc;border-radius:8px}
    button{padding:10px 20px;border:none;border-radius:8px;cursor:pointer;font-weight:600;margin-top:10px}
    .btn{background:#0d47a1;color:#fff}
    .btn:hover{background:#1976d2}
    .logout{background:#d32f2f;color:#fff}
    .bus-card{background:#fafafa;padding:15px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);margin:10px 0;text-align:center}
    .seat-circle{display:inline-block;width:40px;height:40px;line-height:40px;border-radius:50%;background:#0d47a1;color:#fff;margin:5px}
    table{width:100%;border-collapse:collapse;margin-top:20px}
    th,td{padding:10px;border-bottom:1px solid #ddd;font-size:14px}
    th{background:#f5f5f5;color:#0d47a1}
  </style>
</head>
<body>
  <h1><i class="fas fa-bus"></i> Lagan Bus Booking</h1>
  <p class="subtitle">Your journey, our priority</p>

  <!-- Passenger Search -->
  <div class="card" id="passenger-container">
    <h2>Find My Bookings</h2>
    <input type="tel" id="passenger-contact" placeholder="Enter Phone Number"/>
    <button class="btn" onclick="searchPassenger()">Search</button>
  </div>

  <!-- Passenger Bookings -->
  <div class="card" id="passenger-details" style="display:none"></div>

  <!-- Admin Login -->
  <div class="card" id="admin-login" style="display:none">
    <h2>Admin Login</h2>
    <input type="password" id="admin-password" placeholder="Password"/>
    <button class="btn" onclick="adminLogin()">Login</button>
    <button onclick="showSearch()">Cancel</button>
  </div>

  <!-- Admin Panel -->
  <div class="card" id="admin-panel" style="display:none;max-width:900px">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>Admin Dashboard</h2>
      <button class="logout" onclick="adminLogout()">Logout</button>
    </div>
    <h3>Add / Edit Passenger</h3>
    <input id="p-name" placeholder="Name"/>
    <input id="p-contact" placeholder="Contact"/>
    <input id="p-bus" placeholder="Bus"/>
    <input type="time" id="p-time"/>
    <input type="date" id="p-date"/>
    <input id="p-seat" placeholder="Seat (e.g. 12,13)"/>
    <input id="p-pickup" placeholder="Pickup"/>
    <select id="p-payment"><option>Paid</option><option>Pending</option><option>Cancelled</option></select>
    <button class="btn" id="save-btn" onclick="savePassenger()">Save</button>
    <button onclick="resetForm()">Cancel</button>
    <table>
      <thead><tr><th>Name</th><th>Contact</th><th>Bus</th><th>Date</th><th>Seat</th><th>Actions</th></tr></thead>
      <tbody id="passengers-list"></tbody>
    </table>
  </div>

  <!-- Admin Button -->
  <button class="btn" style="position:fixed;bottom:20px;right:20px" onclick="showAdminLogin()"><i class="fas fa-user-shield"></i> Admin</button>

<script>
const scriptURL="https://script.google.com/macros/s/AKfycbzN8kkBPEbJe3VAaYmosM8Yc24JkVZWayBaemdPRzm5SHl4gDeoxWommbNFfcy-zB6FnA/exec"; // replace with your Apps Script URL

// Passenger
function searchPassenger(){
  let contact=document.getElementById("passenger-contact").value.trim();
  fetch(scriptURL+"?action=getPassenger&contact="+contact).then(r=>r.json()).then(d=>{
    let box=document.getElementById("passenger-details");box.innerHTML="";
    if(d.success && d.bookings.length){
      box.innerHTML=`<h3>Hi, ${d.bookings[0].name} ðŸ‘‹</h3>`;
      d.bookings.forEach(b=>{
        let seats=b.seat.split(",").map(s=>`<span class='seat-circle'>${s.trim()}</span>`).join("");
        box.innerHTML+=`
          <div class="bus-card">
            <h4>${b.bus} - ${b.date} ${b.time}</h4>
            <div>${seats}</div>
            <p>Pickup: ${b.pickup||"N/A"} | Payment: ${b.payment}</p>
          </div>`;
      });
      document.getElementById("passenger-container").style.display="none";
      box.style.display="block";
    } else {Swal.fire("No Bookings","No bookings found","info");}
  });
}

// Admin login
function showAdminLogin(){document.getElementById("admin-login").style.display="block";document.getElementById("passenger-container").style.display="none";}
function adminLogin(){
  if(document.getElementById("admin-password").value==="admin123"){
    document.getElementById("admin-login").style.display="none";
    document.getElementById("admin-panel").style.display="block";
    loadPassengers();
  }else{Swal.fire("Error","Wrong password","error");}
}
function adminLogout(){document.getElementById("admin-panel").style.display="none";document.getElementById("passenger-container").style.display="block";}
function showSearch(){document.getElementById("admin-login").style.display="none";document.getElementById("passenger-container").style.display="block";}

// CRUD
function loadPassengers(){
  fetch(scriptURL+"?action=getAll").then(r=>r.json()).then(d=>{
    if(d.success){renderPassengers(d.passengers)}
  });
}
function renderPassengers(list){
  let tbody=document.getElementById("passengers-list");tbody.innerHTML="";
  window.passengers=list;
  list.forEach(p=>{
    tbody.innerHTML+=`<tr>
      <td>${p.name}</td><td>${p.contact}</td><td>${p.bus}</td>
      <td>${p.date}</td><td>${p.seat}</td>
      <td><button onclick="editPassenger('${p.id}')">Edit</button>
      <button onclick="deletePassenger('${p.id}')">Delete</button></td></tr>`;
  });
}
function savePassenger(){
  let data={
    name:document.getElementById("p-name").value,
    contact:document.getElementById("p-contact").value,
    bus:document.getElementById("p-bus").value,
    time:document.getElementById("p-time").value,
    date:document.getElementById("p-date").value,
    seat:document.getElementById("p-seat").value,
    pickup:document.getElementById("p-pickup").value,
    payment:document.getElementById("p-payment").value
  };
  if(document.getElementById("save-btn").dataset.id){
    data.id=document.getElementById("save-btn").dataset.id;
    data.action="update";
  }else{data.action="create";}
  fetch(scriptURL,{method:"POST",body:JSON.stringify(data)}).then(r=>r.json()).then(d=>{
    if(d.success){Swal.fire("Saved","Passenger saved","success");resetForm();loadPassengers();}
    else{Swal.fire("Error","Failed","error");}
  });
}
function editPassenger(id){
  let p=window.passengers.find(x=>x.id==id);
  if(!p) return;
  document.getElementById("p-name").value=p.name;
  document.getElementById("p-contact").value=p.contact;
  document.getElementById("p-bus").value=p.bus;
  document.getElementById("p-time").value=p.time;
  document.getElementById("p-date").value=p.date;
  document.getElementById("p-seat").value=p.seat;
  document.getElementById("p-pickup").value=p.pickup;
  document.getElementById("p-payment").value=p.payment;
  document.getElementById("save-btn").dataset.id=p.id;
}
function resetForm(){
  ["p-name","p-contact","p-bus","p-time","p-date","p-seat","p-pickup"].forEach(id=>document.getElementById(id).value="");
  document.getElementById("save-btn").removeAttribute("data-id");
}
function deletePassenger(id){
  Swal.fire({title:"Delete?",showCancelButton:true}).then(res=>{
    if(res.isConfirmed){
      fetch(scriptURL,{method:"POST",body:JSON.stringify({action:"delete",id})}).then(r=>r.json()).then(d=>{
        if(d.success){Swal.fire("Deleted","","success");loadPassengers();}
      });
    }
  });
}
</script>
</body>
</html>

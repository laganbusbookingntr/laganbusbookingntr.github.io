<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Lagan Bus Booking | Luxury Bus Travel Sri Lanka</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,900;1,900&display=swap" rel="stylesheet">
<style>
/* ===================== PREMIUM VARIABLES ===================== */
:root {
  --primary: #0b1f3a;
  --primary-dark: #08162a;
  --primary-light: #1f3e72;
  --gold: #d8b35d;
  --gold-light: #f4dfaa;
  --gold-dark: #b89446;
  --primary-gradient: linear-gradient(135deg, #0b1f3a 0%, #1f3e72 100%);
  --gold-gradient: linear-gradient(135deg, #d8b35d 0%, #f0d58c 50%, #d8b35d 100%);
  --secondary: #0f766e;
  --secondary-dark: #115e59;
  --accent: #8b5cf6;
  --danger: #ef4444;
  --warning: #f59e0b;
  --light: #ffffff;
  --dark: #0b1220;
  --gray: #7a8598;
  --slate-900: #0b1f3a;
  --slate-950: #030915;
  --glass: rgba(255, 255, 255, 0.95);
  --glass-dark: rgba(7, 16, 32, 0.95);
  --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
  --shadow-md: 0 12px 32px -8px rgba(0, 0, 0, 0.12);
  --shadow-lg: 0 24px 48px -12px rgba(0, 0, 0, 0.16);
  --shadow-xl: 0 32px 64px -16px rgba(0, 0, 0, 0.2);
  --shadow-blue: 0 16px 48px rgba(11, 31, 58, 0.3);
  --shadow-green: 0 16px 48px rgba(16, 185, 129, 0.25);
  --radius-sm: 12px;
  --radius-md: 16px;
  --radius-lg: 20px;
  --radius-xl: 24px;
  --radius-full: 9999px;
  --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  --gradient-primary: linear-gradient(135deg, #0b1f3a 0%, #1f3e72 100%);
  --gradient-success: linear-gradient(135deg, #0f766e 0%, #1f3e72 100%);
  --gradient-dark: linear-gradient(135deg, #0b1f3a 0%, #0f172a 100%);
  --gradient-light: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
  --image-overlay: linear-gradient(to bottom, rgba(11, 31, 58, 0.85), rgba(2, 6, 23, 0.95));
  
  /* Light theme colors */
  --surface: #ffffff;
  --card: #ffffff;
  --text-primary: #0b1f3a;
  --text-secondary: #4a5568;
  --border: #e2e8f0;
  --icon-color: #d8b35d;
}

[data-theme="dark"] {
  --primary: #3b82f6;
  --primary-dark: #1d4ed8;
  --primary-light: #60a5fa;
  --gold: #d4af37;
  --light: #0f172a;
  --dark: #f1f5f9;
  --gray: #94a3b8;
  --glass: rgba(15, 23, 42, 0.95);
  --glass-dark: rgba(30, 41, 59, 0.95);
  --gradient-light: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  --surface: #0f172a;
  --card: #1e293b;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --border: #334155;
  --icon-color: #d4af37;
}

/* ===================== SCROLLING YELLOW LINE ===================== */
.scrolling-line {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: linear-gradient(90deg, 
    transparent 0%, 
    var(--gold) 20%, 
    #ffd700 50%, 
    var(--gold) 80%, 
    transparent 100%);
  z-index: 1001;
  animation: scrollLine 2s linear infinite;
  box-shadow: 0 0 20px var(--gold);
}

@keyframes scrollLine {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* ===================== BASE STYLES ===================== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  background: var(--surface);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  opacity: 0;
  animation: pageFadeIn 0.6s ease-out forwards;
  font-weight: 400;
  line-height: 1.6;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  touch-action: manipulation;
  transition: all 0.5s;
}

@keyframes pageFadeIn {
  to { opacity: 1; }
}

.font-display {
  font-family: 'Playfair Display', serif;
}

/* ===================== WELCOME OVERLAY ===================== */
.welcome-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--slate-950) 0%, var(--slate-900) 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: welcomeFadeOut 0.5s ease 1s forwards;
}

@keyframes welcomeFadeOut {
  0% { opacity: 1; }
  100% { opacity: 0; visibility: hidden; }
}

.welcome-logo {
  width: 140px;
  height: 140px;
  background: var(--gold-gradient);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 30px;
  animation: logoPulse 1.5s ease infinite;
  position: relative;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(212, 175, 55, 0.3);
}

@keyframes logoPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.welcome-logo i {
  font-size: 56px;
  color: var(--slate-900);
  animation: logoFloat 2s ease-in-out infinite;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-10px) rotate(5deg); }
}

.welcome-text {
  text-align: center;
  animation: textSlideUp 0.8s ease 0.3s both;
}

@keyframes textSlideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.welcome-title {
  font-size: 3rem;
  font-weight: 900;
  color: white;
  margin-bottom: 10px;
  background: linear-gradient(135deg, #ffffff 0%, #e0f2fe 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.welcome-subtitle {
  font-size: 1.1rem;
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
}

/* ===================== ADMIN CONTACT BADGE ===================== */
.admin-contact-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1.5rem;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 9999px;
  color: white;
  font-size: 0.9rem;
  font-weight: 600;
  margin: 1.5rem 0;
  transition: all 0.3s ease;
  cursor: pointer;
  text-decoration: none;
  border: none;
  outline: none;
  min-width: 240px;
  justify-content: center;
}

.admin-contact-badge:hover {
  background: rgba(216, 179, 93, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.2);
}

.admin-contact-badge i {
  color: var(--gold);
}

/* ===================== ELITE NAVIGATION ===================== */
.elite-nav {
  position: fixed;
  top: 4px;
  left: 0;
  right: 0;
  z-index: 1000;
  padding: 1rem 2rem;
  transition: all 0.5s ease;
  background: transparent;
  backdrop-filter: blur(10px);
}

.elite-nav.scrolled {
  background: rgba(11, 31, 58, 0.9);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

[data-theme="dark"] .elite-nav.scrolled {
  background: rgba(15, 23, 42, 0.9);
}

.nav-container {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
}

.nav-brand {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  transition: transform 0.5s;
}

.nav-brand:hover {
  transform: translateY(-2px);
}

.nav-logo {
  width: 44px;
  height: 44px;
  background: var(--gold-gradient);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--slate-950);
  font-size: 1.25rem;
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.45);
  transition: transform 0.5s;
}

.nav-brand:hover .nav-logo {
  transform: rotate(12deg);
}

.nav-brand-text {
  font-size: 1.75rem;
  font-weight: 900;
  color: white;
}

.nav-brand-text span {
  color: var(--gold);
}

.nav-links {
  display: none;
  gap: 2.5rem;
}

@media (min-width: 1024px) {
  .nav-links {
    display: flex;
  }
}

.nav-link {
  font-size: 0.75rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  transition: color 0.3s;
}

.nav-link:hover {
  color: var(--gold);
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.theme-toggle-btn {
  width: 44px;
  height: 44px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  color: white;
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
}

.theme-toggle-btn:hover {
  background: var(--gold);
  color: var(--slate-950);
  transform: scale(1.1);
}

.nav-book-btn {
  padding: 0.75rem 1.75rem;
  background: var(--gold-gradient);
  color: var(--slate-950);
  border: none;
  border-radius: 1rem;
  font-size: 0.75rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.35);
}

.nav-book-btn:hover {
  background: linear-gradient(135deg, #e7c776 0%, #d0a848 100%);
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(216, 179, 93, 0.45);
}

.mobile-menu-btn {
  display: none;
  align-items: center;
  justify-content: center;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  width: 40px;
  height: 40px;
  font-size: 1.25rem;
  cursor: pointer;
  z-index: 1001;
}

/* ===================== ENHANCED ELITE HERO ===================== */
.elite-hero {
  position: relative;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  margin-bottom: 0;
  padding: 0;
}

.hero-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(rgba(11, 31, 58, 0.85), rgba(11, 31, 58, 0.95)),
              url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80&auto=enhance');
  background-size: cover;
  background-position: center 70%;
  background-attachment: fixed;
  z-index: -2;
  animation: enhancedBackground 40s ease-in-out infinite alternate;
  transform-origin: center;
}

@keyframes enhancedBackground {
  0% { 
    transform: scale(1);
    filter: brightness(1) contrast(1);
  }
  25% {
    transform: scale(1.05);
    filter: brightness(1.1) contrast(1.05);
  }
  50% {
    transform: scale(1.03);
    filter: brightness(1.05) contrast(1.1);
  }
  75% {
    transform: scale(1.07);
    filter: brightness(1.15) contrast(1.08);
  }
  100% { 
    transform: scale(1.05);
    filter: brightness(1.2) contrast(1.1);
  }
}

.hero-background::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(
      ellipse at 20% 20%,
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.1) 25%,
      rgba(0, 0, 0, 0) 60%
    ),
    radial-gradient(
      ellipse at 80% 80%,
      rgba(216, 179, 93, 0.15) 0%,
      rgba(216, 179, 93, 0.08) 30%,
      rgba(0, 0, 0, 0) 70%
    ),
    radial-gradient(
      ellipse at 50% 50%,
      rgba(255, 255, 255, 0.1) 0%,
      rgba(255, 255, 255, 0.05) 40%,
      rgba(0, 0, 0, 0) 80%
    );
  animation: ambientLights 15s ease-in-out infinite alternate;
  pointer-events: none;
  mix-blend-mode: screen;
}

@keyframes ambientLights {
  0% { 
    opacity: 0.4;
    transform: translateX(0) translateY(0);
  }
  33% {
    opacity: 0.6;
    transform: translateX(-3%) translateY(2%);
  }
  66% {
    opacity: 0.8;
    transform: translateX(2%) translateY(-2%);
  }
  100% { 
    opacity: 0.5;
    transform: translateX(3%) translateY(3%);
  }
}

.hero-background::before {
  content: '';
  position: absolute;
  top: -100%;
  left: -100%;
  width: 300%;
  height: 300%;
  background: linear-gradient(
    45deg,
    transparent 30%,
    rgba(255, 255, 255, 0.05) 50%,
    transparent 70%
  );
  animation: lightBeams 30s linear infinite;
  pointer-events: none;
  z-index: 1;
}

@keyframes lightBeams {
  0% { transform: rotate(0deg) translateX(-50%); }
  100% { transform: rotate(360deg) translateX(-50%); }
}

.particles {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

.particle {
  position: absolute;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 50%;
  animation: floatParticle 15s infinite linear;
}

@keyframes floatParticle {
  0% {
    transform: translateY(100vh) translateX(0) scale(0.5);
    opacity: 0;
  }
  10% {
    opacity: 0.8;
  }
  90% {
    opacity: 0.8;
  }
  100% {
    transform: translateY(-100px) translateX(100px) scale(1);
    opacity: 0;
  }
}

.hero-content {
  position: relative;
  z-index: 3;
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
  color: white;
  animation: headerSlideUp 0.8s ease 0.2s both;
}

@keyframes headerSlideUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.hero-badge {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 1.5rem;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 9999px;
  color: white;
  font-size: 0.75rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  margin-bottom: 2.5rem;
  animation: badgeGlow 2s ease-in-out infinite alternate;
}

@keyframes badgeGlow {
  0% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.1); }
  100% { box-shadow: 0 0 20px rgba(216, 179, 93, 0.3); }
}

.hero-badge i {
  color: var(--gold);
  font-size: 1rem;
}

.hero-title {
  font-size: 3.5rem;
  font-family: 'Playfair Display', serif;
  font-weight: 900;
  font-style: italic;
  color: white;
  margin-bottom: 1rem;
  line-height: 1;
  text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  animation: titleShine 3s ease-in-out infinite alternate;
}

@keyframes titleShine {
  0% { 
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
  100% { 
    text-shadow: 
      0 0 30px rgba(255, 255, 255, 0.3),
      0 4px 20px rgba(0, 0, 0, 0.3);
  }
}

@media (min-width: 768px) {
  .hero-title {
    font-size: 5rem;
  }
}

@media (min-width: 1024px) {
  .hero-title {
    font-size: 6rem;
  }
}

.hero-title span {
  font-style: normal;
  color: var(--gold);
  text-shadow: 0 4px 20px rgba(216, 179, 93, 0.3);
  background: linear-gradient(135deg, #d8b35d 0%, #f4dfaa 50%, #d8b35d 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: goldShimmer 2s ease-in-out infinite;
}

@keyframes goldShimmer {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

.hero-subtitle {
  font-size: 1.125rem;
  color: rgba(255, 255, 255, 0.9);
  max-width: 36rem;
  margin: 0 auto 1rem;
  line-height: 1.6;
  font-weight: 400;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  animation: subtitleFade 1s ease 0.5s both;
}

@keyframes subtitleFade {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ===================== HERO ACTIONS ===================== */
.hero-actions {
  display: flex;
  flex-direction: row;
  gap: 1rem;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
}

@media (max-width: 768px) {
  .hero-actions {
    flex-direction: column;
    gap: 0.75rem;
  }
}

.hero-primary-btn {
  padding: 0.75rem 1.5rem;
  background: rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.3);
  border-radius: 9999px;
  color: white;
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  transition: all 0.3s ease;
  animation: buttonPulse 2s ease-in-out infinite;
  text-decoration: none;
  position: relative;
  overflow: hidden;
  border: none;
  outline: none;
  min-width: 240px;
  justify-content: center;
}

@keyframes buttonPulse {
  0%, 100% { 
    box-shadow: 0 0 10px rgba(216, 179, 93, 0.1);
  }
  50% { 
    box-shadow: 0 0 20px rgba(216, 179, 93, 0.3);
  }
}

.hero-primary-btn:hover {
  background: rgba(216, 179, 93, 0.3);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.2);
  animation: none;
}

.hero-primary-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: var(--gold-gradient);
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: -1;
  border-radius: 9999px;
}

.hero-primary-btn:hover::before {
  opacity: 1;
}

.hero-primary-btn:hover i {
  transform: translateX(5px);
}

.hero-primary-btn i {
  transition: transform 0.3s ease;
  color: var(--gold);
}

.scroll-indicator {
  position: absolute;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  animation: bounce 2s infinite;
  color: var(--gold);
}

@keyframes bounce {
  0%, 100% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(-10px); }
}

/* ===================== SCROLL TO TOP BUTTON ===================== */
.scroll-to-top {
  position: fixed;
  bottom: 100px;
  right: 2rem;
  width: 50px;
  height: 50px;
  background: var(--gold-gradient);
  border: none;
  border-radius: 50%;
  color: var(--slate-950);
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 998;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.4);
  animation: scrollButtonGlow 2s ease-in-out infinite alternate;
}

@keyframes scrollButtonGlow {
  0% { box-shadow: 0 8px 24px rgba(216, 179, 93, 0.4); }
  100% { box-shadow: 0 8px 32px rgba(216, 179, 93, 0.6), 0 0 20px rgba(216, 179, 93, 0.3); }
}

.scroll-to-top.visible {
  opacity: 1;
  transform: translateY(0);
}

.scroll-to-top:hover {
  transform: translateY(-5px) scale(1.1);
  animation: none;
  box-shadow: 0 12px 36px rgba(216, 179, 93, 0.6);
}

.scroll-to-top i {
  color: var(--slate-950);
}

/* ===================== SUPPORT PANEL ===================== */
.support-panel {
  position: fixed;
  top: 50%;
  right: 0;
  transform: translateY(-50%) translateX(100%);
  background: var(--glass);
  backdrop-filter: blur(20px);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg) 0 0 var(--radius-lg);
  padding: 1.5rem;
  width: 300px;
  box-shadow: var(--shadow-xl);
  z-index: 997;
  transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.support-panel.open {
  transform: translateY(-50%) translateX(0);
}

.support-toggle {
  position: absolute;
  left: -40px;
  top: 50%;
  transform: translateY(-50%);
  background: var(--primary);
  color: white;
  border: none;
  border-radius: var(--radius-md) 0 0 var(--radius-md);
  width: 40px;
  height: 80px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.25rem;
  box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);
}

.support-header {
  margin-bottom: 1rem;
}

.support-header h3 {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: var(--text-primary);
  font-size: 1.1rem;
}

.support-content {
  margin-top: 1rem;
}

.support-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.75rem;
  background: rgba(216, 179, 93, 0.1);
  border-radius: var(--radius-md);
  margin-bottom: 0.75rem;
}

.support-item i {
  color: var(--gold);
  font-size: 1.25rem;
}

.support-info h4 {
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.25rem;
}

.support-info p {
  font-size: 0.8rem;
  color: var(--text-secondary);
}

/* ===================== BOOKING PORTAL ===================== */
.booking-portal {
  position: relative;
  max-width: 1200px;
  margin: 0 auto 6rem;
  padding: 0 2rem;
}

.portal-wrapper {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  overflow: hidden;
}

.portal-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  flex-direction: row;
}

@media (max-width: 768px) {
  .portal-tabs {
    flex-direction: column;
  }
}

.portal-tab {
  flex: 1;
  padding: 2.5rem 3rem;
  display: flex;
  align-items: center;
  gap: 1.25rem;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.5s;
  position: relative;
}

@media (max-width: 768px) {
  .portal-tab {
    padding: 1.5rem;
    flex-direction: column;
    text-align: center;
    gap: 0.75rem;
  }
}

.portal-tab.active {
  background: var(--card);
  color: var(--primary);
}

.portal-tab.active::after {
  content: '';
  position: absolute;
  bottom: -1px;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--gold-gradient);
}

.portal-tab:hover:not(.active) {
  background: rgba(216, 179, 93, 0.08);
}

.portal-tab i {
  font-size: 1.75rem;
  color: var(--icon-color);
}

.tab-label {
  font-size: 0.625rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--gray);
  margin-bottom: 0.25rem;
}

.tab-title {
  font-size: 1.5rem;
  font-weight: 900;
  color: var(--text-primary);
}

.portal-tab-content {
  display: none;
  padding: 3rem;
}

#newTab {
  display: block;
}

/* ===================== CHECK BOOKING TAB ===================== */
.check-booking-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 3rem;
}

@media (min-width: 992px) {
  .check-booking-grid {
    grid-template-columns: 1fr 1fr;
  }
}

.search-section {
  background: var(--card);
  padding: 2rem;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
}

.search-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
}

.search-icon {
  width: 60px;
  height: 60px;
  background: var(--primary-gradient);
  border-radius: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
}

.search-title {
  font-size: 1.5rem;
  font-weight: 900;
  color: var(--text-primary);
}

.phone-input-wrapper {
  position: relative;
  margin-bottom: 1.5rem;
}

.phone-input {
  width: 100%;
  padding: 1.125rem 1.125rem 1.125rem 3.5rem;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 1rem;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-primary);
  transition: all 0.3s;
}

.phone-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
}

.phone-input-icon {
  position: absolute;
  left: 1.125rem;
  top: 50%;
  transform: translateY(-50%);
  color: var(--primary);
  font-size: 1.25rem;
}

.search-btn {
  width: 100%;
  padding: 1.125rem;
  background: var(--primary-gradient);
  color: white;
  border: none;
  border-radius: 1rem;
  font-size: 1rem;
  font-weight: 900;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  transition: all 0.3s;
  box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
}

.search-btn i {
  color: white;
}

.search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
}

.results-section {
  background: var(--card);
  padding: 2rem;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
  min-height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.no-booking {
  text-align: center;
  opacity: 0.6;
}

.no-booking i {
  font-size: 4rem;
  color: var(--primary);
  margin-bottom: 1.5rem;
}

.no-booking h3 {
  font-size: 1.25rem;
  font-weight: 900;
  color: var(--text-primary);
  margin-bottom: 0.75rem;
}

.no-booking p {
  color: var(--text-secondary);
  max-width: 300px;
  margin: 0 auto;
  line-height: 1.5;
}

.ticket-card {
  background: var(--card);
  border-radius: var(--radius-xl);
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  animation: cardReveal 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  border: 1px solid var(--border);
  width: 100%;
}

@keyframes cardReveal {
  0% { opacity: 0; transform: perspective(1000px) rotateX(-15deg) scale(0.95); }
  100% { opacity: 1; transform: perspective(1000px) rotateX(0deg) scale(1); }
}

.ticket-header {
  background: var(--primary-gradient);
  color: white;
  padding: 2rem;
  text-align: center;
}

.ticket-title {
  font-size: 1.5rem;
  font-weight: 900;
  margin-bottom: 0.5rem;
}

.ticket-subtitle {
  opacity: 0.95;
  font-weight: 500;
}

.ticket-body {
  padding: 2rem;
}

.passenger-section {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 2rem;
  border-bottom: 2px dashed var(--border);
}

.passenger-avatar {
  width: 80px;
  height: 80px;
  background: var(--primary-gradient);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 2rem;
  margin: 0 auto 1.25rem;
  box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
}

.passenger-name {
  font-size: 1.75rem;
  font-weight: 900;
  color: var(--text-primary);
  margin-bottom: 0.75rem;
}

.booking-id {
  color: var(--text-secondary);
  font-weight: 600;
  background: rgba(216, 179, 93, 0.1);
  padding: 0.5rem 1rem;
  border-radius: 9999px;
  display: inline-block;
}

.details-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.25rem;
  margin-bottom: 2rem;
}

.detail-card {
  background: var(--card);
  padding: 1.5rem;
  border-radius: 1rem;
  border: 1px solid var(--border);
  transition: all 0.3s;
}

.detail-card:hover {
  transform: translateY(-4px);
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
}

.detail-icon {
  width: 48px;
  height: 48px;
  background: rgba(216, 179, 93, 0.1);
  border-radius: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--icon-color);
  font-size: 1.25rem;
  margin-bottom: 1rem;
}

.detail-label {
  font-size: 0.75rem;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1.2px;
  margin-bottom: 0.5rem;
  font-weight: 700;
}

.detail-value {
  font-size: 1.25rem;
  font-weight: 800;
  color: var(--text-primary);
}

.detail-value.paid {
  color: var(--secondary);
}

.detail-value.pending {
  color: var(--warning);
}

.ticket-actions {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

@media (min-width: 640px) {
  .ticket-actions {
    flex-direction: row;
  }
}

.btn {
  padding: 1rem 1.5rem;
  border-radius: 1rem;
  border: none;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  transition: all 0.3s;
  flex: 1;
}

.btn-primary {
  background: var(--gold-gradient);
  color: var(--slate-950);
  box-shadow: 0 8px 24px rgba(216, 179, 93, 0.4);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(216, 179, 93, 0.5);
}

.btn-secondary {
  background: var(--card);
  color: var(--text-primary);
  border: 1px solid var(--border);
}

.btn-secondary:hover {
  background: var(--primary);
  color: white;
  border-color: var(--primary);
}

/* ===================== NEW BOOKING TAB ===================== */
.new-booking-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 3rem;
}

@media (min-width: 992px) {
  .new-booking-grid {
    grid-template-columns: 1.2fr 0.8fr;
  }
}

.booking-form-section {
  background: var(--card);
  padding: 2rem;
  border-radius: var(--radius-lg);
  border: 1px solid var(--border);
}

.form-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
}

.form-icon {
  width: 60px;
  height: 60px;
  background: var(--gradient-success);
  border-radius: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
  box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
}

.form-title {
  font-size: 1.5rem;
  font-weight: 900;
  color: var(--text-primary);
}

.form-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.25rem;
  margin-bottom: 1.5rem;
}

@media (min-width: 768px) {
  .form-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

.form-group {
  position: relative;
}

.form-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.875rem;
}

.form-label i {
  color: var(--icon-color);
}

.form-input,
.form-select {
  width: 100%;
  padding: 1.125rem 1.125rem 1.125rem 3.5rem;
  background: var(--card);
  border: 2px solid var(--border);
  border-radius: 1rem;
  font-size: 1rem;
  font-weight: 500;
  color: var(--text-primary);
  transition: all 0.3s;
  appearance: none;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
}

.form-select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%232563eb' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1.125rem center;
  background-size: 1.125rem;
}

.dark .form-select {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2394A3B8' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
}

.form-icon-left {
  position: absolute;
  left: 1.125rem;
  top: 3.625rem;
  transform: translateY(-50%);
  color: var(--icon-color);
  font-size: 1.25rem;
}

.total-cost-display {
  background: rgba(16, 185, 129, 0.1);
  padding: 1.5rem;
  border-radius: 1rem;
  border: 1px solid rgba(16, 185, 129, 0.2);
  margin-top: 1.5rem;
  display: block;
}

.cost-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.75rem;
}

.cost-label {
  color: var(--text-primary);
  font-weight: 600;
}

.cost-value {
  color: var(--primary);
  font-weight: 700;
}

.cost-total {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 0.75rem;
  border-top: 1px solid rgba(16, 185, 129, 0.2);
}

.total-label {
  color: var(--text-primary);
  font-weight: 700;
  font-size: 1.1rem;
}

.total-amount {
  color: var(--secondary);
  font-weight: 800;
  font-size: 1.25rem;
}

.bank-details-btn {
  width: 100%;
  padding: 1rem;
  background: rgba(37, 99, 235, 0.1);
  color: var(--primary);
  border: 1px solid rgba(37, 99, 235, 0.3);
  border-radius: 1rem;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-top: 1.5rem;
  transition: all 0.3s;
}

.bank-details-btn i {
  color: var(--icon-color);
}

.bank-details-btn:hover {
  background: rgba(37, 99, 235, 0.2);
}

.whatsapp-btn {
  width: 100%;
  padding: 1.125rem;
  background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
  color: white;
  border: none;
  border-radius: 1rem;
  font-size: 1rem;
  font-weight: 900;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
  margin-top: 1.5rem;
  transition: all 0.3s;
  box-shadow: 0 8px 24px rgba(37, 211, 102, 0.2);
}

.whatsapp-btn i {
  color: white;
}

.whatsapp-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(37, 211, 102, 0.3);
}

.instructions-section {
  background: linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.95)),
              url('https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80');
  background-size: cover;
  background-position: center;
  padding: 2rem;
  border-radius: 2rem;
  border: 1px solid rgba(37, 99, 235, 0.15);
  backdrop-filter: blur(20px);
  animation: background-zoom 30s ease-in-out infinite alternate;
}

@keyframes background-zoom {
  0% { background-size: 100%; }
  100% { background-size: 120%; }
}

.instructions-header {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 2rem;
}

.instructions-icon {
  width: 60px;
  height: 60px;
  background: var(--primary-gradient);
  border-radius: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
  box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
}

.instructions-title {
  font-size: 1.5rem;
  font-weight: 900;
  color: white;
}

.steps-list {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.step-item {
  display: flex;
  gap: 1rem;
  align-items: flex-start;
}

.step-number {
  width: 36px;
  height: 36px;
  min-width: 36px;
  background: var(--primary-gradient);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 900;
  font-size: 1rem;
  box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

.step-content {
  flex: 1;
  padding-top: 0.5rem;
}

.step-title {
  font-size: 1.05rem;
  font-weight: 700;
  color: white;
  margin-bottom: 0.375rem;
}

.step-description {
  font-size: 0.875rem;
  color: rgba(255, 255, 255, 0.9);
  line-height: 1.5;
}

.highlight-step {
  background: rgba(16, 185, 129, 0.2);
  padding: 1.25rem;
  border-radius: 1rem;
  border: 1px solid rgba(16, 185, 129, 0.3);
  margin-top: 0.75rem;
}

.highlight-step .step-title {
  color: var(--secondary);
}

.whatsapp-contact {
  background: rgba(37, 211, 102, 0.2);
  padding: 1.5rem;
  border-radius: 1rem;
  border: 1px solid rgba(37, 211, 102, 0.3);
  text-align: center;
  backdrop-filter: blur(10px);
}

.contact-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--secondary);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.contact-link {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 1.5rem;
  background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
  color: white;
  text-decoration: none;
  border-radius: 1rem;
  font-weight: 700;
  transition: all 0.3s;
  box-shadow: 0 8px 24px rgba(37, 211, 102, 0.2);
}

.contact-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(37, 211, 102, 0.3);
}

/* ===================== FEATURES SECTION ===================== */
.features-section {
  padding: 6rem 2rem;
  max-width: 1200px;
  margin: 0 auto;
}

.section-header {
  text-align: center;
  max-width: 48rem;
  margin: 0 auto 5rem;
}

.section-badge {
  font-size: 0.75rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: var(--primary);
  margin-bottom: 1rem;
}

.section-title {
  font-size: 3rem;
  font-weight: 900;
  color: var(--text-primary);
  margin-bottom: 1.5rem;
  line-height: 1.1;
}

.section-divider {
  height: 0.375rem;
  width: 6rem;
  background: var(--primary);
  border-radius: 9999px;
  margin: 0 auto;
}

.features-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 2rem;
}

@media (min-width: 768px) {
  .features-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

.feature-card {
  background: var(--card);
  padding: 2.5rem;
  border-radius: 2rem;
  border: 1px solid var(--border);
  transition: all 0.5s;
}

.feature-card:hover {
  transform: translateY(-8px);
  border-color: var(--primary);
  box-shadow: var(--shadow-lg);
}

.feature-icon {
  width: 70px;
  height: 70px;
  background: var(--primary-gradient);
  border-radius: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.75rem;
  margin-bottom: 1.5rem;
  box-shadow: 0 8px 24px rgba(37, 99, 235, 0.3);
  transition: all 0.5s;
}

.feature-card:hover .feature-icon {
  transform: scale(1.1) rotate(5deg);
}

.feature-title {
  font-size: 1.5rem;
  font-weight: 900;
  color: var(--text-primary);
  margin-bottom: 1rem;
}

.feature-description {
  color: var(--text-secondary);
  line-height: 1.6;
}

/* ===================== FLEET SECTION ===================== */
.fleet-section {
  padding: 6rem 2rem;
  max-width: 1200px;
  margin: 0 auto;
  background: var(--slate-950);
  border-radius: 4rem;
  overflow: hidden;
  position: relative;
}

.fleet-background {
  position: absolute;
  top: 0;
  right: 0;
  width: 24rem;
  height: 24rem;
  background: rgba(37, 99, 235, 0.1);
  border-radius: 50%;
  filter: blur(120px);
  transform: translate(50%, -50%);
}

.fleet-content {
  position: relative;
  z-index: 10;
  display: grid;
  grid-template-columns: 1fr;
  gap: 4rem;
  align-items: center;
}

@media (min-width: 1024px) {
  .fleet-content {
    grid-template-columns: 1fr 1fr;
  }
}

.fleet-info h2 {
  font-size: 3.5rem;
  font-weight: 900;
  color: white;
  margin-bottom: 2.5rem;
  line-height: 1.1;
}

.fleet-info h2 span {
  color: var(--gold);
}

.fleet-list {
  display: flex;
  flex-direction: column;
  gap: 2.5rem;
}

.fleet-item {
  display: flex;
  gap: 2.5rem;
  align-items: flex-start;
}

.fleet-number {
  font-size: 3rem;
  font-weight: 900;
  color: var(--gold);
  opacity: 0.4;
  font-family: 'Playfair Display', serif;
  transition: opacity 0.5s;
}

.fleet-item:hover .fleet-number {
  opacity: 1;
}

.fleet-details h3 {
  font-size: 1.5rem;
  font-weight: 900;
  color: white;
  margin-bottom: 0.75rem;
}

.fleet-description {
  color: rgba(255, 255, 255, 0.8);
  margin-bottom: 1rem;
  line-height: 1.6;
}

.fleet-tags {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.fleet-tag {
  font-size: 0.625rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  color: var(--gold);
  border: 1px solid rgba(216, 179, 93, 0.3);
  padding: 0.375rem 0.75rem;
  border-radius: 9999px;
  background: rgba(216, 179, 93, 0.1);
}

.fleet-image {
  position: relative;
}

.fleet-image img {
  width: 100%;
  border-radius: 3.5rem;
  box-shadow: 0 24px 48px -12px rgba(0, 0, 0, 0.16);
  border: 8px solid rgba(255, 255, 255, 0.05);
  filter: grayscale(0.5) opacity(0.95);
  transition: all 1s;
  animation: image-zoom 20s ease-in-out infinite alternate;
}

@keyframes image-zoom {
  0% { transform: scale(1); }
  100% { transform: scale(1.05); }
}

.fleet-image:hover img {
  filter: grayscale(0) opacity(1);
}

.fleet-badge {
  position: absolute;
  bottom: -2.5rem;
  left: -2.5rem;
  background: var(--primary);
  padding: 2.5rem;
  border-radius: 3rem;
  box-shadow: 0 24px 48px -12px rgba(0, 0, 0, 0.16);
  transform: translateY(0);
  transition: all 0.5s;
}

.fleet-image:hover .fleet-badge {
  transform: translateY(-10px);
}

.fleet-badge p {
  font-size: 1.5rem;
  font-weight: 900;
  color: white;
  line-height: 1.2;
}

/* ===================== FOOTER ===================== */
.elite-footer {
  background: var(--slate-950);
  color: white;
  padding: 8rem 2rem 4rem;
  margin-top: 6rem;
}

.footer-content {
  max-width: 1200px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr;
  gap: 5rem;
  margin-bottom: 5rem;
}

@media (min-width: 768px) {
  .footer-content {
    grid-template-columns: repeat(4, 1fr);
  }
}

.footer-brand {
  grid-column: 1 / -1;
}

@media (min-width: 768px) {
  .footer-brand {
    grid-column: span 2;
  }
}

.footer-logo {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 2.5rem;
}

.footer-logo-icon {
  font-size: 2.5rem;
  color: var(--gold);
}

.footer-logo-text {
  font-size: 2.5rem;
  font-weight: 900;
  color: white;
}

.footer-logo-text span {
  color: var(--gold);
}

.footer-description {
  color: rgba(255, 255, 255, 0.8);
  font-size: 1.125rem;
  line-height: 1.6;
  max-width: 28rem;
  margin-bottom: 2.5rem;
}

.footer-social {
  display: flex;
  gap: 0.75rem;
}

.social-link {
  width: 3.5rem;
  height: 3.5rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.875rem;
  font-weight: 900;
  color: white;
  text-decoration: none;
  transition: all 0.3s;
}

.social-link:hover {
  background: var(--gold);
  color: var(--slate-950);
  transform: translateY(-2px);
}

.footer-column h4 {
  font-size: 0.75rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: var(--gold);
  margin-bottom: 2.5rem;
}

.footer-links {
  list-style: none;
}

.footer-links li {
  margin-bottom: 1rem;
}

.footer-links a {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  font-size: 0.875rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.2em;
  transition: color 0.3s;
}

.footer-links a:hover {
  color: var(--gold);
}

.footer-contact {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.contact-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
}

.contact-divider {
  width: 0.25rem;
  height: 3rem;
  background: var(--gold);
  border-radius: 9999px;
}

.contact-text {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.875rem;
  line-height: 1.5;
}

.contact-phone {
  font-size: 1.5rem;
  font-weight: 900;
  color: white;
}

.footer-bottom {
  max-width: 1200px;
  margin: 0 auto;
  padding-top: 4rem;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-direction: column;
  gap: 2rem;
  align-items: center;
  justify-content: space-between;
}

@media (min-width: 768px) {
  .footer-bottom {
    flex-direction: row;
  }
}

.copyright {
  font-size: 0.625rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: rgba(255, 255, 255, 0.6);
}

.developer-badge {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  padding: 0.75rem 1.5rem;
  border-radius: 1rem;
  font-size: 0.625rem;
  font-weight: 900;
  text-transform: uppercase;
  letter-spacing: 0.3em;
  color: rgba(255, 255, 255, 0.6);
  cursor: pointer;
}

.developer-badge i {
  color: var(--gold);
}

.developer-badge strong {
  color: var(--gold);
}

/* ===================== LOADING OVERLAY ===================== */
.loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(15, 23, 42, 0.95);
  backdrop-filter: blur(10px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9998;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

.loading-overlay.active {
  opacity: 1;
  pointer-events: all;
}

.bus-loader {
  position: relative;
  width: 200px;
  height: 120px;
  margin-bottom: 30px;
}

.bus {
  position: relative;
  width: 120px;
  height: 60px;
  margin: 0 auto;
}

.bus-body {
  position: absolute;
  width: 100%;
  height: 40px;
  background: var(--gold-gradient);
  border-radius: 10px 10px 0 0;
  overflow: hidden;
  animation: busMove 2.5s ease-in-out infinite;
  box-shadow: 0 5px 15px rgba(216, 179, 93, 0.4);
}

@keyframes busMove {
  0%, 100% {
    transform: translateX(-40px);
  }
  50% {
    transform: translateX(40px);
  }
}

.bus-front {
  position: absolute;
  right: -15px;
  top: 10px;
  width: 30px;
  height: 20px;
  background: var(--gold-dark);
  border-radius: 0 5px 5px 0;
}

.bus-windows {
  position: absolute;
  top: 8px;
  left: 10px;
  display: flex;
  gap: 4px;
}

.window {
  width: 25px;
  height: 15px;
  background: rgba(255, 255, 255, 0.8);
  border-radius: 3px;
}

.bus-wheels {
  position: absolute;
  bottom: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 15px;
}

.wheel {
  width: 20px;
  height: 20px;
  background: var(--dark);
  border-radius: 50%;
  border: 3px solid var(--gold);
  animation: wheelSpin 1s linear infinite;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
}

@keyframes wheelSpin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.road {
  position: absolute;
  bottom: -15px;
  left: -20px;
  right: -20px;
  height: 4px;
  background: linear-gradient(90deg, 
    transparent 0%, 
    var(--gold) 20%, 
    var(--gold) 80%, 
    transparent 100%);
  animation: roadMove 1.5s linear infinite;
}

@keyframes roadMove {
  0% {
    background-position: 0 0;
  }
  100% {
    background-position: 200px 0;
  }
}

.loading-text {
  color: white;
  font-size: 1.1rem;
  font-weight: 600;
  text-align: center;
  background: linear-gradient(90deg, #d8b35d, #f4dfaa, #d8b35d);
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: gradientShift 2s linear infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% center; }
  100% { background-position: 200% center; }
}

/* ===================== UTILITIES ===================== */
.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  background: transparent;
  position: relative;
}

.spinner::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 20px;
  height: 20px;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23d8b35d'%3E%3Cpath d='M18 17H6v-2h12v2zm0-4H6v-2h12v2zm0-4H6V7h12v2z'/%3E%3C/svg%3E") no-repeat center;
  animation: busPulse 1s ease-in-out infinite;
}

@keyframes busPulse {
  0%, 100% { transform: scale(1) translateX(0); }
  50% { transform: scale(1.1) translateX(2px); }
}

.hidden {
  display: none;
}

.mobile-nav-links {
  display: none;
  position: fixed;
  top: 70px;
  left: 0;
  right: 0;
  background: var(--glass);
  backdrop-filter: blur(20px);
  flex-direction: column;
  gap: 0;
  padding: 1rem 0;
  transform: translateY(-100%);
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 999;
  box-shadow: var(--shadow-md);
  border-bottom: 1px solid var(--border);
}

.mobile-nav-links.active {
  display: flex;
  transform: translateY(0);
  opacity: 1;
}

.mobile-nav-links .nav-link {
  padding: 1rem 2rem;
  text-align: center;
  border-bottom: 1px solid var(--border);
  font-size: 0.9rem;
}

.mobile-nav-links .nav-link:last-child {
  border-bottom: none;
}

/* ===================== COPY SUCCESS MESSAGE ===================== */
.copied-message {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--secondary);
  color: white;
  padding: 12px 24px;
  border-radius: var(--radius-md);
  font-weight: 600;
  z-index: 10000;
  opacity: 0;
  transition: all 0.3s ease;
  box-shadow: var(--shadow-green);
  display: flex;
  align-items: center;
  gap: 8px;
}

.copied-message.show {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* ===================== ENHANCED MOBILE VIEW ===================== */
@media (max-width: 768px) {
  html {
    font-size: 14px;
  }
  
  .scrolling-line {
    height: 3px;
  }
  
  .elite-hero {
    min-height: 90vh;
  }
  
  .hero-background {
    animation: mobile-slow-zoom 40s ease-in-out infinite alternate;
    background-attachment: scroll;
  }
  
  @keyframes mobile-slow-zoom {
    0% { transform: scale(1.1) rotate(0deg); }
    100% { transform: scale(1.2) rotate(0.3deg); }
  }
  
  .hero-title {
    font-size: 2.5rem;
  }
  
  .hero-subtitle {
    font-size: 1rem;
    padding: 0 1rem;
  }
  
  .admin-contact-badge {
    padding: 0.75rem 1.5rem;
    font-size: 0.9rem;
    min-width: 220px;
    width: auto;
  }
  
  .hero-primary-btn {
    padding: 0.75rem 1.5rem;
    font-size: 0.9rem;
    min-width: 220px;
    width: auto;
  }
  
  .hero-actions {
    flex-direction: column;
    gap: 0.75rem;
    align-items: center;
    width: 100%;
  }
  
  .elite-nav {
    padding: 0.75rem 1rem;
    top: 3px;
  }
  
  .nav-container {
    padding: 0;
  }
  
  .nav-brand-text {
    font-size: 1.25rem;
  }
  
  .nav-logo {
    width: 36px;
    height: 36px;
    font-size: 1rem;
  }
  
  .nav-book-btn {
    padding: 0.5rem 1rem;
    font-size: 0.625rem;
    display: none;
  }
  
  .nav-actions {
    gap: 0.5rem;
  }
  
  .theme-toggle-btn {
    width: 36px;
    height: 36px;
    font-size: 1rem;
  }
  
  .mobile-menu-btn {
    display: flex;
  }
  
  .nav-links {
    display: none;
  }
  
  .booking-portal {
    margin: 0 auto 4rem;
    padding: 0 1rem;
  }
  
  .portal-wrapper {
    border-radius: 2rem;
  }
  
  .new-booking-grid,
  .check-booking-grid {
    grid-template-columns: 1fr;
    gap: 2rem;
  }
  
  .booking-form-section,
  .search-section,
  .results-section,
  .instructions-section {
    padding: 1.5rem;
    border-radius: 1.5rem;
  }
  
  .form-grid {
    grid-template-columns: 1fr;
  }
  
  .support-panel {
    width: 280px;
  }
  
  .scroll-to-top {
    bottom: 90px;
    right: 1rem;
    width: 45px;
    height: 45px;
    font-size: 1rem;
  }
  
  .features-section,
  .fleet-section {
    padding: 4rem 1rem;
  }
  
  .section-title {
    font-size: 2rem;
  }
  
  .features-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .feature-card {
    padding: 1.5rem;
  }
  
  .fleet-section {
    border-radius: 2rem;
    padding: 3rem 1rem;
  }
  
  .fleet-info h2 {
    font-size: 2rem;
  }
  
  .fleet-item {
    gap: 1rem;
  }
  
  .fleet-number {
    font-size: 2rem;
  }
  
  .fleet-image img {
    border-radius: 2rem;
  }
  
  .fleet-badge {
    position: relative;
    bottom: 0;
    left: 0;
    margin-top: 1rem;
    padding: 1.5rem;
  }
  
  .elite-footer {
    padding: 4rem 1rem 2rem;
  }
  
  .footer-bottom {
    flex-direction: column;
    text-align: center;
    gap: 1.5rem;
  }
  
  .bus-loader {
    width: 180px;
    height: 100px;
  }
  
  .bus {
    width: 100px;
    height: 50px;
  }
}

@media (max-width: 480px) {
  .hero-title {
    font-size: 2rem;
  }
  
  .portal-tab {
    padding: 1rem;
  }
  
  .hero-badge {
    font-size: 0.6rem;
    padding: 0.5rem 1rem;
  }
  
  .admin-contact-badge {
    font-size: 0.75rem;
    padding: 0.6rem 1.2rem;
    min-width: 200px;
  }
  
  .hero-primary-btn {
    font-size: 0.75rem;
    padding: 0.6rem 1.2rem;
    min-width: 200px;
  }
  
  .scroll-to-top {
    bottom: 80px;
  }
  
  .support-panel {
    width: 250px;
  }
  
  .bus-loader {
    width: 150px;
    height: 90px;
  }
  
  .bus {
    width: 90px;
    height: 45px;
  }
}

@supports (-webkit-touch-callout: none) {
  .hero-background {
    background-attachment: scroll;
    animation: ios-mobile-zoom 35s ease-in-out infinite alternate;
  }
  
  @keyframes ios-mobile-zoom {
    0% { transform: scale(1.05); }
    100% { transform: scale(1.15); }
  }
}

*:focus {
  outline: none;
}

button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms;
    animation-iteration-count: 1;
    transition-duration: 0.01ms;
  }
}

.hero-actions button,
.hero-actions a {
  min-width: 240px;
  text-align: center;
  justify-content: center;
}
</style>
</head>

<body>
<!-- Scrolling Yellow Line -->
<div class="scrolling-line"></div>

<!-- Welcome Overlay -->
<div class="welcome-overlay" id="welcomeOverlay">
  <div class="welcome-logo">
    <i class="fas fa-bus"></i>
  </div>
  <div class="welcome-text">
    <h1 class="welcome-title">LAGAN BUS BOOKING</h1>
    <p class="welcome-subtitle">Excellence in Motion</p>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="bus-loader">
    <div class="bus">
      <div class="bus-body">
        <div class="bus-windows">
          <div class="window"></div>
          <div class="window"></div>
          <div class="window"></div>
        </div>
        <div class="bus-front"></div>
      </div>
      <div class="bus-wheels">
        <div class="wheel"></div>
        <div class="wheel"></div>
      </div>
      <div class="road"></div>
    </div>
  </div>
  <p class="loading-text" id="loadingText">Processing...</p>
</div>

<!-- Scroll to Top Button -->
<button class="scroll-to-top" id="scrollToTop">
  <i class="fas fa-chevron-up"></i>
</button>

<!-- Support Panel -->
<div class="support-panel" id="supportPanel">
  <button class="support-toggle" onclick="toggleSupportPanel()">
    <i class="fas fa-headset"></i>
  </button>
  <div class="support-header">
    <h3><i class="fas fa-life-ring"></i> Support Center</h3>
  </div>
  <div class="support-content">
    <div class="support-item">
      <i class="fas fa-user-tie"></i>
      <div class="support-info">
        <h4>MOHAMED FAWAS</h4>
        <p>Owner & Manager</p>
      </div>
    </div>
    <div class="support-item">
      <i class="fas fa-phone"></i>
      <div class="support-info">
        <h4>+94 701 362 527</h4>
        <p>24/7 WhatsApp Support</p>
      </div>
    </div>
    <div class="support-item">
      <i class="fas fa-map-marker-alt"></i>
      <div class="support-info">
        <h4>Location</h4>
        <p>Nintavur Main Road, Eastern Province</p>
      </div>
    </div>
    <div class="support-item">
      <i class="fas fa-clock"></i>
      <div class="support-info">
        <h4>Boarding Time</h4>
        <p>Arrive 15 minutes before departure</p>
      </div>
    </div>
  </div>
</div>

<!-- Elite Navigation -->
<nav class="elite-nav" id="eliteNav">
  <div class="nav-container">
    <div class="nav-brand" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
      <div class="nav-logo">
        <i class="fas fa-bus"></i>
      </div>
      <span class="nav-brand-text">LAGAN<span>BUS</span></span>
    </div>
    
    <!-- Desktop Navigation -->
    <div class="nav-links">
      <a href="#fleet" class="nav-link">Fleet</a>
      <a href="#safety" class="nav-link">Safety</a>
      <a href="#routes" class="nav-link">Routes</a>
      <a href="#support" class="nav-link" onclick="toggleSupportPanel(); return false;">Support</a>
    </div>
    
    <div class="nav-actions">
      <!-- Mobile Menu Button -->
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </button>
      
      <button class="theme-toggle-btn" id="themeToggle">
        <i class="fas fa-moon" id="themeIcon"></i>
      </button>
      <button class="nav-book-btn" onclick="switchTab('newTab')">
        Book Seat
      </button>
    </div>
  </div>
  
  <!-- Mobile Navigation Links -->
  <div class="mobile-nav-links" id="mobileNavLinks">
    <a href="#fleet" class="nav-link" onclick="closeMobileMenu()">Fleet</a>
    <a href="#safety" class="nav-link" onclick="closeMobileMenu()">Safety</a>
    <a href="#routes" class="nav-link" onclick="closeMobileMenu()">Routes</a>
    <a href="#support" class="nav-link" onclick="toggleSupportPanel(); closeMobileMenu();">Support</a>
    <a href="#booking-portal" class="nav-link" onclick="switchTab('newTab'); closeMobileMenu();">Book Seat</a>
  </div>
</nav>

<!-- Elite Hero Section -->
<header class="elite-hero">
  <div class="particles" id="particles"></div>
  <div class="hero-background"></div>
  <div class="hero-content">
    <div class="hero-badge">
      <i class="fas fa-star"></i>
      Voted #1 Luxury Experience 2024
    </div>
    
    <h1 class="hero-title">
      Travel In <br/>
      <span>Elite Class.</span>
    </h1>
    
    <p class="hero-subtitle">
      Sri Lanka's premier long-distance coach service. Redefining comfort, safety, and punctuality for the modern traveler.
    </p>
    
    <div class="hero-actions">
      <button class="admin-contact-badge" onclick="openAdminWhatsApp()">
        <i class="fas fa-phone-alt"></i>
        <span>Admin: +94 701 362 527</span>
      </button>
      
      <button class="hero-primary-btn" onclick="switchTab('newTab')">
        Reserve Now
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
    
    <div class="scroll-indicator">
      <i class="fas fa-chevron-down"></i>
    </div>
  </div>
</header>

<!-- Booking Portal -->
<section class="booking-portal" id="booking-portal">
  <div class="portal-wrapper">
    <div class="portal-tabs">
      <button class="portal-tab active" onclick="switchTab('newTab')">
        <i class="fas fa-calendar-plus"></i>
        <div>
          <div class="tab-label">New Journey</div>
          <div class="tab-title">Reservation</div>
        </div>
      </button>
      <button class="portal-tab" onclick="switchTab('checkTab')">
        <i class="fas fa-search"></i>
        <div>
          <div class="tab-label">Track Ticket</div>
          <div class="tab-title">Verify Status</div>
        </div>
      </button>
    </div>
    
    <!-- New Booking Tab -->
    <div id="newTab" class="portal-tab-content">
      <div class="new-booking-grid">
        <!-- Booking Form -->
        <div class="booking-form-section">
          <div class="form-header">
            <div class="form-icon">
              <i class="fas fa-calendar-plus"></i>
            </div>
            <h2 class="form-title">New Reservation</h2>
          </div>
          
          <form id="bookingForm" onsubmit="return false;">
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label" for="passengerName">
                  <i class="fas fa-user"></i>
                  Full Name
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-user"></i>
                </div>
                <input type="text" id="passengerName" class="form-input" 
                       placeholder="Enter your full name" required>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="passengerPhone">
                  <i class="fas fa-phone"></i>
                  WhatsApp Number
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-mobile-alt"></i>
                </div>
                <input type="tel" id="passengerPhone" class="form-input" 
                       placeholder="947XXXXXXXX" maxlength="10" required
                       inputmode="numeric"
                       pattern="[0-9]*">
              </div>
              
              <div class="form-group">
                <label class="form-label" for="fromLocation">
                  <i class="fas fa-map-marker-alt"></i>
                  From (Origin)
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-location-arrow"></i>
                </div>
                <select id="fromLocation" class="form-select" required>
                  <option value="">Select origin city</option>
                  <option value="Nintavur">Nintavur</option>
                  <option value="Addalaichenai">Addalaichenai</option>
                  <option value="Akkaraipattu">Akkaraipattu</option>
                  <option value="Pottuvil">Pottuvil</option>
                  <option value="Panama">Panama</option>
                  <option value="Lahugala">Lahugala</option>
                  <option value="Monaragala">Monaragala</option>
                  <option value="Bibile">Bibile</option>
                  <option value="Medagama">Medagama</option>
                  <option value="Wellawaya">Wellawaya</option>
                  <option value="Badulla">Badulla</option>
                  <option value="Bandarawela">Bandarawela</option>
                  <option value="Hali-Ela">Hali-Ela</option>
                  <option value="Passara">Passara</option>
                  <option value="Mahiyanganaya">Mahiyanganaya</option>
                  <option value="Kandy">Kandy</option>
                  <option value="Peradeniya">Peradeniya</option>
                  <option value="Gampola">Gampola</option>
                  <option value="Nawalapitiya">Nawalapitiya</option>
                  <option value="Hatton">Hatton</option>
                  <option value="Nanu Oya">Nanu Oya</option>
                  <option value="Nuwara Eliya">Nuwara Eliya</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="toLocation">
                  <i class="fas fa-map-marker-alt"></i>
                  To (Destination)
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-flag-checkered"></i>
                </div>
                <select id="toLocation" class="form-select" required>
                  <option value="">Select destination city</option>
                  <option value="Nintavur">Nintavur</option>
                  <option value="Addalaichenai">Addalaichenai</option>
                  <option value="Akkaraipattu">Akkaraipattu</option>
                  <option value="Pottuvil">Pottuvil</option>
                  <option value="Panama">Panama</option>
                  <option value="Lahugala">Lahugala</option>
                  <option value="Monaragala">Monaragala</option>
                  <option value="Bibile">Bibile</option>
                  <option value="Medagama">Medagama</option>
                  <option value="Wellawaya">Wellawaya</option>
                  <option value="Badulla">Badulla</option>
                  <option value="Bandarawela">Bandarawela</option>
                  <option value="Hali-Ela">Hali-Ela</option>
                  <option value="Passara">Passara</option>
                  <option value="Mahiyanganaya">Mahiyanganaya</option>
                  <option value="Kandy">Kandy</option>
                  <option value="Peradeniya">Peradeniya</option>
                  <option value="Gampola">Gampola</option>
                  <option value="Nawalapitiya">Nawalapitiya</option>
                  <option value="Hatton">Hatton</option>
                  <option value="Nanu Oya">Nanu Oya</option>
                  <option value="Nuwara Eliya">Nuwara Eliya</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="travelDate">
                  <i class="fas fa-calendar-alt"></i>
                  Travel Date
                </label>
                <div class="form-icon-left">
                  <i class="far fa-calendar"></i>
                </div>
                <input type="date" id="travelDate" class="form-input" required>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="busName">
                  <i class="fas fa-bus"></i>
                  Preferred Bus
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-bus"></i>
                </div>
                <select id="busName" class="form-select" required>
                  <option value="">Select bus service</option>
                  <option value="Sakeer Express">Sakeer Express</option>
                  <option value="RS Express">RS Express</option>
                  <option value="Myown Express">Myown Express</option>
                  <option value="Al Ahla">Al Ahla</option>
                  <option value="Al Rashith">Al Rashith</option>
                  <option value="Star Travels">Star Travels</option>
                  <option value="Lloyds Travels">Lloyds Travels</option>
                  <option value="Super Line">Super Line</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label" for="seatCount">
                  <i class="fas fa-chair"></i>
                  Number of Seats
                </label>
                <div class="form-icon-left">
                  <i class="fas fa-users"></i>
                </div>
                <select id="seatCount" class="form-select" required>
                  <option value="">Select seats</option>
                  <option value="1">1 Seat</option>
                  <option value="2">2 Seats</option>
                  <option value="3">3 Seats</option>
                  <option value="4">4 Seats</option>
                  <option value="5">5 Seats</option>
                  <option value="6">6 Seats</option>
                  <option value="7">7 Seats</option>
                  <option value="8">8 Seats</option>
                  <option value="9">9 Seats</option>
                  <option value="10">10 Seats</option>
                </select>
              </div>
            </div>
            
            <!-- Total Cost Display -->
            <div id="totalCostDisplay" class="total-cost-display">
              <div class="cost-row">
                <span class="cost-label" style="text-align: center; width: 100%; color: var(--text-secondary);">
                  Select bus service and number of seats to see total cost
                </span>
              </div>
            </div>
            
            <!-- Bank Details Button -->
            <button type="button" id="showBankDetailsBtn" class="bank-details-btn">
              <i class="fas fa-university"></i> View Bank Payment Details
            </button>
            
            <button type="button" id="whatsappSubmitBtn" class="whatsapp-btn">
              <i class="fab fa-whatsapp"></i> Send Booking via WhatsApp
            </button>
          </form>
        </div>
        
        <!-- Instructions Card -->
        <div class="instructions-section">
          <div class="instructions-header">
            <div class="instructions-icon">
              <i class="fas fa-graduation-cap"></i>
            </div>
            <h2 class="instructions-title">How to Book</h2>
          </div>
          
          <div class="steps-list">
            <div class="step-item">
              <div class="step-number">1</div>
              <div class="step-content">
                <h3 class="step-title">Fill Booking Form</h3>
                <p class="step-description">Complete all details accurately in the form above</p>
              </div>
            </div>
            
            <div class="step-item">
              <div class="step-number">2</div>
              <div class="step-content">
                <h3 class="step-title">Submit via WhatsApp</h3>
                <p class="step-description">Click the WhatsApp button to send your request</p>
              </div>
            </div>
            
            <div class="step-item">
              <div class="step-number">3</div>
              <div class="step-content">
                <div class="highlight-step">
                  <h4 class="step-title">
                    <i class="fas fa-exclamation-circle"></i>
                    Important Step
                  </h4>
                  <p class="step-description">
                    When WhatsApp opens, <strong>manually attach your payment slip photo/screenshot</strong> before sending
                  </p>
                </div>
              </div>
            </div>
            
            <div class="step-item">
              <div class="step-number">4</div>
              <div class="step-content">
                <h3 class="step-title">Wait for Confirmation</h3>
                <p class="step-description">Our team will verify and confirm within 24 hours</p>
              </div>
            </div>
            
            <div class="step-item">
              <div class="step-number">5</div>
              <div class="step-content">
                <h3 class="step-title">Check Your Booking</h3>
                <p class="step-description">Use the "Verify Status" tab to view confirmed details</p>
                <div class="highlight-step" style="margin-top: 10px;">
                  <h4 class="step-title">
                    <i class="fas fa-search"></i>
                    How to Find My Booking
                  </h4>
                  <p class="step-description">
                     Go to "Verify Status" tab<br>
                     Enter your WhatsApp number<br>
                     Click "Check Booking Status"<br>
                     View your booking details
                  </p>
                </div>
              </div>
            </div>
            
            <div class="step-item">
              <div class="step-number">6</div>
              <div class="step-content">
                <div class="highlight-step">
                  <h4 class="step-title">
                    <i class="fas fa-clock"></i>
                    Boarding Instructions
                  </h4>
                  <p class="step-description">
                    <strong>Arrive 15 minutes before departure</strong> at the pickup point. Keep your booking confirmation ready. Be punctual to ensure smooth boarding.
                  </p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="whatsapp-contact">
            <h3 class="contact-title">
              <i class="fab fa-whatsapp"></i> Need Immediate Help?
            </h3>
            <a href="https://wa.me/94701362527" target="_blank" class="contact-link">
              <i class="fab fa-whatsapp"></i> Chat on WhatsApp
            </a>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Check Booking Tab -->
    <div id="checkTab" class="portal-tab-content">
      <div class="check-booking-grid">
        <!-- Search Section -->
        <div class="search-section">
          <div class="search-header">
            <div class="search-icon">
              <i class="fas fa-search"></i>
            </div>
            <h2 class="search-title">Find Your Booking</h2>
          </div>
          
          <div class="phone-input-wrapper">
            <div class="phone-input-icon">
              <i class="fas fa-phone"></i>
            </div>
            <input type="tel" id="checkPhone" class="phone-input" 
                   placeholder="947XXXXXXXX" 
                   maxlength="10"
                   inputmode="numeric"
                   pattern="[0-9]*">
          </div>
          
          <button id="checkBtn" class="search-btn" type="button">
            <i class="fas fa-search"></i> Check Booking Status
          </button>
          
          <!-- Instructions for finding booking -->
          <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(216, 179, 93, 0.1); border-radius: 0.75rem; border-left: 3px solid var(--gold);">
            <h4 style="color: var(--text-primary); font-size: 0.9rem; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-lightbulb"></i> How to find your booking:
            </h4>
            <ul style="color: var(--text-secondary); font-size: 0.85rem; padding-left: 1.2rem; line-height: 1.5;">
              <li>Enter your WhatsApp number used for booking</li>
              <li>Click "Check Booking Status"</li>
              <li>View all your travel details</li>
              <li>Download your ticket if confirmed</li>
            </ul>
          </div>
        </div>
        
        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
          <!-- Initial State -->
          <div id="initialState" class="no-booking">
            <i class="fas fa-ticket-alt"></i>
            <h3>No Booking Selected</h3>
            <p>Enter your WhatsApp number to check your booking status and view all travel details.</p>
          </div>
          
          <!-- Ticket Card -->
          <div class="ticket-card" id="ticketCard" style="display: none;">
            <div class="ticket-header">
              <h3 class="ticket-title">Travel Ticket</h3>
              <p class="ticket-subtitle">Safe travels with Lagan Bus Services</p>
            </div>
            
            <div class="ticket-body">
              <div class="passenger-section">
                <div class="passenger-avatar">
                  <i class="fas fa-user"></i>
                </div>
                <h3 id="displayPassengerName" class="passenger-name">-</h3>
                <p id="displayBookingId" class="booking-id">Booking ID: -</p>
              </div>
              
              <div class="details-grid">
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="fas fa-bus"></i>
                  </div>
                  <div class="detail-label">Bus Service</div>
                  <div id="displayBusName" class="detail-value">-</div>
                </div>
                
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="far fa-calendar-alt"></i>
                  </div>
                  <div class="detail-label">Travel Date & Time</div>
                  <div id="displayDateTime" class="detail-value">-</div>
                </div>
                
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <div class="detail-label">Route</div>
                  <div id="displayRoute" class="detail-value">-</div>
                </div>
                
                <!-- Payment Status Card -->
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="fas fa-check-circle"></i>
                  </div>
                  <div class="detail-label">Payment Status</div>
                  <div id="displayPaymentStatus" class="detail-value pending">-</div>
                </div>
                
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="detail-label">Seat Numbers</div>
                  <div id="displaySeats" class="detail-value">-</div>
                </div>
                
                <div class="detail-card">
                  <div class="detail-icon">
                    <i class="fas fa-money-bill-wave"></i>
                  </div>
                  <div class="detail-label">Total Amount</div>
                  <div id="displayTotalAmount" class="detail-value">-</div>
                </div>
              </div>
              
              <div style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: 0.75rem; margin: 1.5rem 0; border-left: 3px solid #F59E0B;">
                <p style="color: var(--warning); font-weight: 600; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                  <i class="fas fa-clock"></i> Important Reminder:
                </p>
                <p style="color: var(--text-primary); font-size: 0.95rem;">
                  <strong>Be there before 15 minutes at the pickup point.</strong> Arrive early to ensure smooth boarding and avoid delays.
                </p>
              </div>
              
              <div class="ticket-actions">
                <button id="downloadTicketBtn" class="btn btn-primary" type="button">
                  <i class="fas fa-download"></i> Download Ticket
                </button>
                <button class="btn btn-secondary" type="button" onclick="switchTab('newTab')">
                  <i class="fas fa-plus"></i> New Booking
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Features Section -->
<section class="features-section" id="safety">
  <div class="section-header">
    <div class="section-badge">Elite Standards</div>
    <h2 class="section-title">Crafted for the Discerning Traveler.</h2>
    <div class="section-divider"></div>
  </div>
  
  <div class="features-grid">
    <div class="feature-card">
      <div class="feature-icon">
        <i class="fas fa-shield-alt"></i>
      </div>
      <h3 class="feature-title">Premium Safety</h3>
      <p class="feature-description">GPS tracked buses with professional drivers and comprehensive insurance for your peace of mind.</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">
        <i class="fas fa-couch"></i>
      </div>
      <h3 class="feature-title">Luxury Comfort</h3>
      <p class="feature-description">Air-conditioned coaches with reclining seats, WiFi, and entertainment systems for a relaxing journey.</p>
    </div>
    
    <div class="feature-card">
      <div class="feature-icon">
        <i class="fas fa-bolt"></i>
      </div>
      <h3 class="feature-title">Instant Booking</h3>
      <p class="feature-description">Book your seat in seconds with instant confirmation and real-time updates on your booking status.</p>
    </div>
  </div>
</section>

<!-- Fleet Section -->
<section class="fleet-section" id="fleet">
  <div class="fleet-background"></div>
  <div class="fleet-content">
    <div class="fleet-info">
      <h2>Curated <span>Fleet</span> of Modern Coaches.</h2>
      
      <div class="fleet-list">
        <div class="fleet-item">
          <div class="fleet-number">01</div>
          <div class="fleet-details">
            <h3>Executive Class</h3>
            <p class="fleet-description">Luxury coaches with extra legroom, premium seating and onboard entertainment.</p>
            <div class="fleet-tags">
              <span class="fleet-tag">WiFi</span>
              <span class="fleet-tag">USB Charging</span>
              <span class="fleet-tag">Refreshments</span>
            </div>
          </div>
        </div>
        
        <div class="fleet-item">
          <div class="fleet-number">02</div>
          <div class="fleet-details">
            <h3>Express Service</h3>
            <p class="fleet-description">Direct routes with minimal stops for faster travel between major cities.</p>
            <div class="fleet-tags">
              <span class="fleet-tag">Direct Route</span>
              <span class="fleet-tag">Priority Boarding</span>
              <span class="fleet-tag">Air Conditioned</span>
            </div>
          </div>
        </div>
        
        <div class="fleet-item">
          <div class="fleet-number">03</div>
          <div class="fleet-details">
            <h3>Family Coach</h3>
            <p class="fleet-description">Spacious seating perfect for family travel with child-friendly amenities.</p>
            <div class="fleet-tags">
              <span class="fleet-tag">Family Seating</span>
              <span class="fleet-tag">Storage Space</span>
              <span class="fleet-tag">Entertainment</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="fleet-image">
      <img src="https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?auto=format&fit=crop&q=80&w=1200" alt="Elite Coach Interior">
      <div class="fleet-badge">
        <p>Premium<br/>Hospitality</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="elite-footer">
  <div class="footer-content">
    <div class="footer-brand">
      <div class="footer-logo">
        <i class="fas fa-bus footer-logo-icon"></i>
        <span class="footer-logo-text">LAGAN<span>BUS</span></span>
      </div>
      <p class="footer-description">
        Pioneering luxury travel in Sri Lanka. We don't just move people; we create memories through comfort and reliability since 2010.
      </p>
      <div class="footer-social">
        <a href="#" class="social-link">FB</a>
        <a href="#" class="social-link">IG</a>
        <a href="#" class="social-link">TW</a>
        <a href="#" class="social-link">LI</a>
      </div>
    </div>
    
    <div class="footer-column">
      <h4>Navigation</h4>
      <ul class="footer-links">
        <li><a href="#fleet">Our Fleet</a></li>
        <li><a href="#safety">Safety</a></li>
        <li><a href="#routes">Routes</a></li>
        <li><a href="#support" onclick="toggleSupportPanel(); return false;">Support</a></li>
      </ul>
    </div>
    
    <div class="footer-column">
      <h4>Headquarters</h4>
      <div class="footer-contact">
        <div class="contact-item">
          <div class="contact-divider"></div>
          <div class="contact-text">
            Nintavur Main Road,<br/>
            In front of HNB Bank,<br/>
            Eastern Province
          </div>
        </div>
        <div class="contact-item">
          <div class="contact-divider"></div>
          <div class="contact-phone">+94 701 362 527</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="footer-bottom">
    <p class="copyright"> 2024 Lagan Bus Services. All Rights Reserved.</p>
    <div class="developer-badge" onclick="openWedoxaWebsite()">
      <i class="fas fa-code"></i>
      Designed by <strong>Wedoxa Intelligence</strong>
    </div>
  </div>
</footer>

<script>
// ============ CONFIGURATION ============
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzPkAk2UfXOyH5-DWWw1VRFV5D8ZD9zH3NceHyOCTEWpcUsawG-1cG47V1XUDaVoQGYpg/exec";
const ADMIN_WHATSAPP_NUMBER = "94701362527";
const WEDOXA_WEBSITE = "https://weboxa.com";

const busPrices = {
    "Sakeer Express": 2900,
    "RS Express": 2700,
    "Myown Express": 2800,
    "My Own Express": 2800,
    "Al Ahla": 2900,
    "Al Rashith": 2700,
    "Star Travels": 1600,
    "Lloyds Travels": 2700,
    "Super Line": 2700,
    "Saker Express": 2900
};

const bankDetails = {
    bankName: "Hatton National Bank (HNB)",
    accountName: "MOHAMED FAWAS MT",
    accountNumber: "159020046687",
    branch: "Nintavur Branch",
    reference: "Your Name + Phone"
};

let currentBookingData = null;
let isLoading = false;

// ============ INITIALIZATION ============
document.addEventListener('DOMContentLoaded', function() {
    console.log(' Lagan Bus Booking System Initializing...');
    
    // Initialize theme
    const savedTheme = localStorage.getItem('lagan-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    document.getElementById('themeIcon').className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    
    // Set tomorrow as default travel date
    const today = new Date();
    const tomorrow = new Date(today);
    tomorrow.setDate(today.getDate() + 1);
    
    const dateInput = document.getElementById('travelDate');
    if (dateInput) {
        dateInput.min = today.toISOString().split('T')[0];
        dateInput.value = tomorrow.toISOString().split('T')[0];
    }
    
    // Set up all event listeners
    setupEventListeners();
    setupFormListeners();
    createParticles();
    
    // Handle scroll events
    window.addEventListener('scroll', handleScroll);
    
    // Close welcome overlay after 1.5 seconds
    setTimeout(() => {
        const welcomeOverlay = document.getElementById('welcomeOverlay');
        if (welcomeOverlay) {
            welcomeOverlay.style.opacity = '0';
            setTimeout(() => {
                welcomeOverlay.style.display = 'none';
            }, 500);
        }
    }, 1500);
    
    console.log(' System initialization complete');
});

// ============ EVENT LISTENER SETUP ============
function setupEventListeners() {
    console.log('Setting up event listeners...');
    
    // Check Booking Button
    const checkBtn = document.getElementById('checkBtn');
    if (checkBtn) {
        checkBtn.addEventListener('click', function(e) {
            e.preventDefault();
            checkBooking();
        });
    }
    
    // Download Ticket Button
    const downloadBtn = document.getElementById('downloadTicketBtn');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', function(e) {
            e.preventDefault();
            downloadTicket();
        });
    }
    
    // WhatsApp Submit Button
    const whatsappBtn = document.getElementById('whatsappSubmitBtn');
    if (whatsappBtn) {
        whatsappBtn.addEventListener('click', function(e) {
            e.preventDefault();
            submitBooking();
        });
    }
    
    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', toggleTheme);
    }
    
    // Mobile Menu Button
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    }
    
    // Scroll to Top Button
    const scrollToTopBtn = document.getElementById('scrollToTop');
    if (scrollToTopBtn) {
        scrollToTopBtn.addEventListener('click', scrollToTop);
    }
    
    // Bank Details Button
    const bankDetailsBtn = document.getElementById('showBankDetailsBtn');
    if (bankDetailsBtn) {
        bankDetailsBtn.addEventListener('click', showBankDetailsModal);
    }
    
    // Phone input formatting
    const phoneInputs = document.querySelectorAll('input[type="tel"]');
    phoneInputs.forEach(input => {
        input.addEventListener('input', formatPhone);
    });
    
    // Enter key on check phone input
    const checkPhoneInput = document.getElementById('checkPhone');
    if (checkPhoneInput) {
        checkPhoneInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                checkBooking();
            }
        });
    }
    
    // Developer badge click
    const developerBadge = document.querySelector('.developer-badge');
    if (developerBadge) {
        developerBadge.addEventListener('click', openWedoxaWebsite);
    }
    
    // Admin contact badge
    const adminContactBtn = document.querySelector('.admin-contact-badge');
    if (adminContactBtn) {
        adminContactBtn.addEventListener('click', openAdminWhatsApp);
    }
    
    // Hero primary button
    const heroPrimaryBtn = document.querySelector('.hero-primary-btn');
    if (heroPrimaryBtn) {
        heroPrimaryBtn.addEventListener('click', function() {
            switchTab('newTab');
        });
    }
    
    // Nav book button
    const navBookBtn = document.querySelector('.nav-book-btn');
    if (navBookBtn) {
        navBookBtn.addEventListener('click', function() {
            switchTab('newTab');
        });
    }
    
    // Support panel toggle
    const supportToggle = document.querySelector('.support-toggle');
    if (supportToggle) {
        supportToggle.addEventListener('click', toggleSupportPanel);
    }
    
    // Portal Tabs
    document.querySelectorAll('.portal-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.portal-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            
            const tabId = this.getAttribute('onclick').includes('newTab') ? 'newTab' : 'checkTab';
            switchTab(tabId);
        });
    });
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', closeMobileMenuOnClick);
    
    // Prevent form submission
    const bookingForm = document.getElementById('bookingForm');
    if (bookingForm) {
        bookingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            return false;
        });
    }
}

function setupFormListeners() {
    const busSelect = document.getElementById('busName');
    const seatSelect = document.getElementById('seatCount');
    
    if (busSelect) busSelect.addEventListener('change', updateTotalCostDisplay);
    if (seatSelect) seatSelect.addEventListener('change', updateTotalCostDisplay);
    
    // Initial cost display
    updateTotalCostDisplay();
}

// ============ UI FUNCTIONS ============
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    if (!particlesContainer) return;
    
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        const size = Math.random() * 4 + 1;
        const posX = Math.random() * 100;
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * 5;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${posX}%`;
        particle.style.animationDuration = `${duration}s`;
        particle.style.animationDelay = `${delay}s`;
        particle.style.opacity = Math.random() * 0.5 + 0.2;
        
        particlesContainer.appendChild(particle);
    }
}

function handleScroll() {
    const nav = document.getElementById('eliteNav');
    const scrollTopBtn = document.getElementById('scrollToTop');
    
    if (nav) {
        if (window.scrollY > 50) {
            nav.classList.add('scrolled');
        } else {
            nav.classList.remove('scrolled');
        }
    }
    
    if (scrollTopBtn) {
        if (window.scrollY > 300) {
            scrollTopBtn.classList.add('visible');
        } else {
            scrollTopBtn.classList.remove('visible');
        }
    }
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('lagan-theme', newTheme);
    
    const themeIcon = document.getElementById('themeIcon');
    if (themeIcon) {
        themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }
}

function switchTab(tabId) {
    if (isLoading) return;
    
    console.log('Switching to tab:', tabId);
    
    // Show active tab content
    document.querySelectorAll('.portal-tab-content').forEach(content => {
        content.style.display = 'none';
        if (content.id === tabId) {
            content.style.display = 'block';
        }
    });
    
    // Scroll to booking portal
    const bookingPortal = document.getElementById('booking-portal');
    if (bookingPortal) {
        setTimeout(() => {
            bookingPortal.scrollIntoView({ 
                behavior: 'smooth',
                block: 'start'
            });
        }, 50);
    }
    
    closeMobileMenu();
}

function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileNavLinks');
    if (mobileMenu) {
        mobileMenu.classList.toggle('active');
    }
}

function closeMobileMenu() {
    const mobileMenu = document.getElementById('mobileNavLinks');
    if (mobileMenu) {
        mobileMenu.classList.remove('active');
    }
}

function closeMobileMenuOnClick(event) {
    const mobileMenu = document.getElementById('mobileNavLinks');
    const mobileBtn = document.getElementById('mobileMenuBtn');
    
    if (mobileMenu && mobileBtn && 
        !mobileMenu.contains(event.target) && 
        !mobileBtn.contains(event.target) &&
        mobileMenu.classList.contains('active')) {
        closeMobileMenu();
    }
}

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

function toggleSupportPanel() {
    const panel = document.getElementById('supportPanel');
    if (panel) {
        panel.classList.toggle('open');
    }
}

// ============ BOOKING FUNCTIONS ============
function formatPhone(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 10) value = value.substring(0, 10);
    e.target.value = value;
}

function updateTotalCostDisplay() {
    const busSelect = document.getElementById('busName');
    const seatSelect = document.getElementById('seatCount');
    const totalCostElement = document.getElementById('totalCostDisplay');
    
    if (!busSelect || !seatSelect || !totalCostElement) return;
    
    const selectedBus = busSelect.value;
    const selectedSeats = parseInt(seatSelect.value) || 0;
    
    if (selectedBus && selectedSeats > 0) {
        const pricePerSeat = busPrices[selectedBus] || 0;
        const totalCost = pricePerSeat * selectedSeats;
        
        if (pricePerSeat > 0) {
            totalCostElement.innerHTML = `
                <div class="cost-row">
                    <span class="cost-label">Bus Service:</span>
                    <span class="cost-value">${selectedBus}</span>
                </div>
                <div class="cost-row">
                    <span class="cost-label">Price per Seat:</span>
                    <span class="cost-value">LKR ${pricePerSeat.toLocaleString()}</span>
                </div>
                <div class="cost-row">
                    <span class="cost-label">Seats:</span>
                    <span class="cost-value">${selectedSeats}</span>
                </div>
                <div class="cost-total">
                    <span class="total-label">Total Amount:</span>
                    <span class="total-amount">LKR ${totalCost.toLocaleString()}</span>
                </div>
            `;
        } else {
            totalCostElement.innerHTML = `
                <div class="cost-row">
                    <span class="cost-label" style="text-align: center; width: 100%; color: var(--text-secondary);">
                        Price for ${selectedBus} will be calculated by admin
                    </span>
                </div>
            `;
        }
    } else {
        totalCostElement.innerHTML = `
            <div class="cost-row">
                <span class="cost-label" style="text-align: center; width: 100%; color: var(--text-secondary);">
                    Select bus service and number of seats to see total cost
                </span>
            </div>
        `;
    }
}

// ============ SEAT NUMBER FORMATTING FUNCTIONS ============
function formatSeatsWithIcons(seats) {
    if (!seats || seats.length === 0) {
        return `<div style="color: var(--warning); font-weight: 600;">
            <i class="fas fa-clock"></i> To be assigned
        </div>`;
    }
    
    return seats.map(seat => {
        const seatNumber = seat.toString().trim();
        return `<span class="seat-badge" style="display: inline-block; background: rgba(216, 179, 93, 0.2); color: var(--gold); padding: 6px 12px; margin: 2px; border-radius: 6px; font-weight: 700; border: 1px solid rgba(216, 179, 93, 0.3);">
            <i class="fas fa-chair"></i> ${seatNumber}
        </span>`;
    }).join(' ');
}

function formatSeatNumbers(seatData, seatCount = 1) {
    console.log("Formatting seat numbers:", seatData, "count:", seatCount);
    
    if (!seatData || seatData === "" || seatData === "-" || seatData.toString().toLowerCase().includes("not updated")) {
        if (seatCount > 0) {
            return formatSeatsWithIcons([`${seatCount} Seat${seatCount > 1 ? 's' : ''} (Pending)`]);
        }
        return `<div style="color: var(--warning); font-weight: 600;">
            <i class="fas fa-clock"></i> To be assigned
        </div>`;
    }
    
    const seatStr = seatData.toString().trim();
    
    // Clean the string
    let cleanSeatStr = seatStr.replace(/=$/, '').trim();
    
    // Handle various formats
    let seats = [];
    
    if (cleanSeatStr.includes(',')) {
        seats = cleanSeatStr.split(',').map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes(';')) {
        seats = cleanSeatStr.split(';').map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes(' ')) {
        seats = cleanSeatStr.split(/\s+/).map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes('.')) {
        const parts = cleanSeatStr.split('.');
        // Handle cases like "05.04" where each part is a seat number
        seats = parts
            .map(part => {
                const num = parseInt(part.replace(/\D/g, ''));
                return isNaN(num) ? null : num;
            })
            .filter(num => num !== null && num > 0);
    } else {
        // Try to parse as a single number
        const num = parseInt(cleanSeatStr.replace(/\D/g, ''));
        if (!isNaN(num) && num > 0) {
            seats = [num];
        } else {
            return `<div style="color: var(--warning); font-weight: 600;">
                <i class="fas fa-clock"></i> To be assigned
            </div>`;
        }
    }
    
    // Clean seat numbers (remove leading zeros)
    const cleanedSeats = seats.map(seat => {
        return seat.toString().replace(/^0+(\d)/, '$1');
    }).filter(seat => seat !== '');
    
    // Remove duplicates and sort
    const uniqueSortedSeats = [...new Set(cleanedSeats)]
        .map(s => parseInt(s))
        .sort((a, b) => a - b)
        .map(s => s.toString());
    
    console.log("Formatted seats:", uniqueSortedSeats);
    return formatSeatsWithIcons(uniqueSortedSeats);
}

function calculateTotalAmount(booking) {
    console.log("Calculating total for booking:", booking);
    
    // Method 1: Use existing total if available
    if (booking.Total && booking.Total !== "Not Updated" && booking.Total !== "" && booking.Total !== "-") {
        const total = parseInt(booking.Total);
        if (!isNaN(total) && total > 0) {
            console.log("Using existing total:", total);
            return total;
        }
    }
    
    // Method 2: Calculate from seat amount and seat count
    const seatAmountStr = booking['Seat Amount'] || "";
    const seatCount = parseInt(booking['Seat Count'] || 1);
    
    // Check if seat amount is "Not Updated"
    if (seatAmountStr.toLowerCase().includes("not updated") || seatAmountStr === "-" || seatAmountStr === "") {
        const busName = booking.Bus || booking.bus;
        if (busName && busPrices[busName]) {
            const total = busPrices[busName] * seatCount;
            console.log("Using bus price list:", busName, busPrices[busName], "x", seatCount, "=", total);
            return total;
        }
        console.log("Cannot calculate total - missing information");
        return 0;
    }
    
    // Parse seat amount
    let seatAmount = 0;
    
    if (seatAmountStr.includes(',')) {
        const amounts = seatAmountStr.split(',').map(amt => {
            const cleanAmt = amt.trim();
            return parseInt(cleanAmt) || 0;
        });
        
        const validAmounts = amounts.filter(amt => amt > 0);
        if (validAmounts.length > 0) {
            seatAmount = validAmounts.reduce((sum, amt) => sum + amt, 0);
        }
    } else {
        seatAmount = parseInt(seatAmountStr) || 0;
        
        if (seatAmount > 0 && seatCount > 0) {
            const total = seatAmount * seatCount;
            console.log("Simple calculation:", seatAmount, "x", seatCount, "=", total);
            return total;
        }
    }
    
    if (seatAmount > 0) {
        console.log("Using seat amount sum:", seatAmount);
        return seatAmount;
    }
    
    // Method 3: Fallback to bus price list
    const busName = booking.Bus || booking.bus;
    if (busName && busPrices[busName]) {
        const total = busPrices[busName] * seatCount;
        console.log("Fallback to bus price:", busName, busPrices[busName], "x", seatCount, "=", total);
        return total;
    }
    
    console.log("Could not calculate total amount");
    return 0;
}

// ============ DISPLAY BOOKING DETAILS ============
function displayBookingDetails(booking) {
    console.log('Displaying booking details:', booking);
    
    const seatCount = parseInt(booking['Seat Count'] || 0);
    const seatNumbers = booking['Seat Numbers'] || "";
    
    let seatDisplay = formatSeatNumbers(seatNumbers, seatCount);
    
    let totalAmountDisplay = '-';
    const calculatedTotal = calculateTotalAmount(booking);
    
    if (calculatedTotal > 0) {
        totalAmountDisplay = `LKR ${calculatedTotal.toLocaleString()}`;
    } else if (booking['Seat Amount'] && booking['Seat Amount'].toLowerCase().includes("not updated")) {
        totalAmountDisplay = `
            <span style="color: var(--warning); font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-calculator"></i>
                To be calculated by admin
            </span>
        `;
    }
    
    // Format date for display
    let displayDate = booking.Date || "Date not specified";
    let displayTime = booking.Time || "";
    
    // If date includes time, separate them
    if (displayDate.includes(' ') && !displayTime) {
        const parts = displayDate.split(' ');
        displayDate = parts[0];
        displayTime = parts.slice(1).join(' ');
    }
    
    // Update display elements
    document.getElementById('displayPassengerName').textContent = booking.Name || "Not Provided";
    document.getElementById('displayBookingId').textContent = `Booking ID: ${booking['Booking ID'] || 'N/A'}`;
    document.getElementById('displayBusName').textContent = booking.Bus || "Not Assigned";
    document.getElementById('displayDateTime').textContent = displayTime ? `${displayDate} ${displayTime}` : displayDate;
    document.getElementById('displayRoute').textContent = booking.Destination ? 
        `${booking.Pickup || 'Origin'}  ${booking.Destination}` : 
        booking.Pickup || "Route not specified";
    document.getElementById('displayTotalAmount').innerHTML = totalAmountDisplay;
    document.getElementById('displaySeats').innerHTML = seatDisplay;
    
    // Update payment status
    const paymentStatusElement = document.getElementById('displayPaymentStatus');
    if (paymentStatusElement) {
        const status = (booking['Payment Status'] || "").toLowerCase();
        const statusText = booking['Payment Status'] || "Payment Pending";
        
        if (status.includes('paid') || status.includes('complete') || status.includes('confirmed')) {
            paymentStatusElement.className = 'detail-value paid';
            paymentStatusElement.innerHTML = `
                <span style="color: var(--secondary); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-check-circle"></i>
                    ${statusText}
                </span>
            `;
        } else if (status.includes('pending') || status.includes('waiting')) {
            paymentStatusElement.className = 'detail-value pending';
            paymentStatusElement.innerHTML = `
                <span style="color: var(--warning); display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-clock"></i>
                    ${statusText}
                </span>
            `;
        } else {
            paymentStatusElement.className = 'detail-value';
            paymentStatusElement.textContent = statusText;
        }
    }
    
    // Show ticket card
    document.getElementById('ticketCard').style.display = 'block';
    document.getElementById('initialState').style.display = 'none';
    
    currentBookingData = booking;
}

async function checkBooking() {
    console.log('Checking booking...');
    
    const phoneInput = document.getElementById('checkPhone');
    const phone = phoneInput ? phoneInput.value.trim() : '';
    const btn = document.getElementById('checkBtn');
    
    if (!phone || phone.length < 9) {
        showToast('Please enter a valid 10-digit phone number', 'warning');
        vibrate();
        return;
    }
    
    const originalText = btn ? btn.innerHTML : 'Check';
    if (btn) {
        btn.innerHTML = '<i class="fas fa-bus"></i> Searching...';
        btn.disabled = true;
    }
    
    showLoading('Searching for booking...');
    
    try {
        console.log('Fetching booking for phone:', phone);
        
        // Format phone for search
        let searchPhone = phone.replace(/\D/g, '');
        if (searchPhone.startsWith('0')) {
            searchPhone = '94' + searchPhone.substring(1);
        }
        if (!searchPhone.startsWith('94')) {
            searchPhone = '94' + searchPhone;
        }
        
        // Use the Google Script URL
        const url = `${GOOGLE_SCRIPT_URL}?method=search&phone=${encodeURIComponent(searchPhone)}`;
        console.log('Request URL:', url);
        
        // Add timeout and retry logic
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 10000);
        
        const response = await fetch(url, {
            signal: controller.signal,
            mode: 'cors',
            headers: {
                'Accept': 'application/json'
            }
        });
        
        clearTimeout(timeoutId);
        
        console.log('Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const responseText = await response.text();
        console.log('Response text:', responseText);
        
        let data;
        try {
            data = JSON.parse(responseText);
        } catch (e) {
            console.error('Failed to parse JSON:', e);
            // Try to extract JSON from the response
            const jsonMatch = responseText.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                data = JSON.parse(jsonMatch[0]);
            } else {
                throw new Error('Invalid JSON response');
            }
        }
        
        console.log('Response data:', data);
        
        if (data.success && data.booking) {
            displayBookingDetails(data.booking);
            showToast(' Booking found!', 'success');
        } else if (data.success && !data.booking) {
            showToast(data.message || 'No booking found for this number', 'info');
            resetBookingDisplay();
        } else {
            showToast(data.error || 'Error searching for booking', 'error');
            resetBookingDisplay();
        }
        
    } catch (error) {
        console.error('Error checking booking:', error);
        
        // Show helpful error message
        let errorMessage = 'Error connecting to server. ';
        
        if (error.name === 'AbortError') {
            errorMessage = 'Request timed out. Please check your internet connection and try again.';
        } else if (error.message.includes('Failed to fetch')) {
            errorMessage = 'Network error. Please check your internet connection.';
        } else if (error.message.includes('CORS')) {
            errorMessage = 'Server configuration error. Please contact support.';
        } else {
            errorMessage = 'Please try again later or contact support at +94 701 362 527';
        }
        
        showToast(errorMessage, 'error');
        vibrate();
        
    } finally {
        hideLoading();
        
        if (btn) {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }
}

function resetBookingDisplay() {
    document.getElementById('ticketCard').style.display = 'none';
    document.getElementById('initialState').style.display = 'block';
    currentBookingData = null;
}

async function submitBooking() {
    if (isLoading) return;
    
    const formData = {
        name: document.getElementById('passengerName')?.value.trim() || '',
        phone: document.getElementById('passengerPhone')?.value.trim() || '',
        from: document.getElementById('fromLocation')?.value.trim() || '',
        to: document.getElementById('toLocation')?.value.trim() || '',
        date: document.getElementById('travelDate')?.value || '',
        bus: document.getElementById('busName')?.value || '',
        seats: document.getElementById('seatCount')?.value || ''
    };
    
    console.log('Form data:', formData);
    
    if (!validateBookingForm(formData)) {
        return;
    }
    
    const seatPrice = busPrices[formData.bus] || 0;
    const seatCount = parseInt(formData.seats);
    const totalCost = seatPrice * seatCount;
    
    try {
        const result = await showBookingSummary(formData, totalCost, seatPrice);
        if (result.isConfirmed) {
            await processBookingSubmission(formData, totalCost, seatPrice);
        }
    } catch (error) {
        console.error('Error in submit booking:', error);
        showToast('Error processing booking. Please try again.', 'error');
    }
}

function validateBookingForm(formData) {
    if (!formData.name || formData.name.length < 3) {
        showToast('Please enter your full name (minimum 3 characters)', 'warning');
        vibrate();
        return false;
    }
    
    if (!formData.phone || formData.phone.length < 9) {
        showToast('Please enter a valid 10-digit WhatsApp number', 'warning');
        vibrate();
        return false;
    }
    
    if (!formData.from || !formData.to) {
        showToast('Please select both origin and destination', 'warning');
        vibrate();
        return false;
    }
    
    if (formData.from === formData.to) {
        showToast('Origin and destination cannot be the same', 'warning');
        vibrate();
        return false;
    }
    
    if (!formData.date) {
        showToast('Please select travel date', 'warning');
        vibrate();
        return false;
    }
    
    if (!formData.bus) {
        showToast('Please select a bus service', 'warning');
        vibrate();
        return false;
    }
    
    if (!formData.seats) {
        showToast('Please select number of seats', 'warning');
        vibrate();
        return false;
    }
    
    return true;
}

async function showBookingSummary(formData, totalCost, seatPrice) {
    const dateObj = new Date(formData.date);
    const formattedDate = dateObj.toLocaleDateString('en-GB', {
        weekday: 'short',
        day: 'numeric',
        month: 'short',
        year: 'numeric'
    });
    
    return await Swal.fire({
        icon: 'info',
        title: 'Booking Summary',
        html: `
            <div style="text-align: left; font-size: 1rem">
                <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <h4 style="color: var(--secondary); margin-bottom: 10px; font-weight: 700;">Cost Breakdown</h4>
                    <div style="display: grid; grid-template-columns: 1fr; gap: 8px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Passenger:</span>
                            <span style="color: var(--text-primary); font-weight: 600;">${formData.name}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Phone:</span>
                            <span style="color: var(--primary); font-weight: 600;">${formData.phone}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Route:</span>
                            <span style="color: var(--primary); font-weight: 600;">${formData.from}  ${formData.to}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Date:</span>
                            <span style="color: var(--primary); font-weight: 600;">${formattedDate}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Bus Service:</span>
                            <span style="color: var(--text-primary); font-weight: 600;">${formData.bus}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Seat Price:</span>
                            <span style="color: var(--primary); font-weight: 600;">LKR ${seatPrice.toLocaleString()}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-primary);">Seats:</span>
                            <span style="color: var(--primary); font-weight: 600;">${formData.seats}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 8px; border-top: 1px solid rgba(16, 185, 129, 0.2);">
                            <span style="color: var(--text-primary); font-weight: 700;">Total Amount:</span>
                            <span style="color: var(--secondary); font-weight: 800; font-size: 1.1rem;">LKR ${totalCost.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #F59E0B;">
                    <strong style="color: var(--warning);">Important Steps:</strong>
                    <div style="margin-top: 8px; font-size: 0.95rem;">
                        <p style="margin-bottom: 5px;">
                            <strong>1.</strong> Transfer <strong>LKR ${totalCost.toLocaleString()}</strong> to bank account
                        </p>
                        <p style="margin-bottom: 5px;">
                            <strong>2.</strong> Take screenshot of payment slip
                        </p>
                        <p style="margin-bottom: 5px;">
                            <strong>3.</strong> Attach it to WhatsApp message
                        </p>
                        <p style="margin-bottom: 5px;">
                            <strong>4.</strong> Then send the complete message
                        </p>
                        <p style="margin-top: 8px; color: var(--warning); font-weight: 600;">
                            <i class="fas fa-clock"></i> Arrive 15 minutes before departure at pickup point
                        </p>
                    </div>
                </div>
            </div>
        `,
        showCancelButton: true,
        confirmButtonText: 'Continue to WhatsApp',
        cancelButtonText: 'Cancel',
        confirmButtonColor: '#25D366',
        background: 'var(--card)',
        color: 'var(--text-primary)',
        width: window.innerWidth < 768 ? '90vw' : '650px',
        backdrop: 'rgba(0, 0, 0, 0.3)'
    });
}

async function processBookingSubmission(formData, totalCost, seatPrice) {
    showLoading('Submitting booking...');
    
    try {
        const dateObj = new Date(formData.date);
        const formattedDate = dateObj.toLocaleDateString('en-GB', {
            weekday: 'short',
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });
        
        const whatsappMessage = createWhatsAppMessage(formData, formattedDate, totalCost, seatPrice);
        
        const response = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: new URLSearchParams({
                method: 'add',
                Name: formData.name,
                Phone: formData.phone,
                From: formData.from,
                To: formData.to,
                Date: formData.date,
                Bus: formData.bus,
                'Seat Count': formData.seats,
                'Seat Amount': seatPrice,
                'Total Amount': totalCost,
                'Payment Status': 'Pending',
                Timestamp: new Date().toISOString()
            })
        });
        
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        
        const data = await response.json();
        const bookingId = data.bookingId || 'LGN-' + Date.now().toString().slice(-6);
        
        resetBookingForm();
        hideLoading();
        openWhatsAppWithMessage(whatsappMessage);
        showBookingSuccess(bookingId, totalCost, formData);
        
    } catch (error) {
        hideLoading();
        console.error('Error submitting booking:', error);
        
        const dateObj = new Date(formData.date);
        const formattedDate = dateObj.toLocaleDateString('en-GB', {
            weekday: 'short',
            day: 'numeric',
            month: 'short',
            year: 'numeric'
        });
        const whatsappMessage = createWhatsAppMessage(formData, formattedDate, totalCost, seatPrice);
        openWhatsAppWithMessage(whatsappMessage);
    }
}

function createWhatsAppMessage(formData, formattedDate, totalCost, seatPrice) {
    return `*NEW LAGAN BUS BOOKING RESERVATION*%0A%0A` +
        ` *Passenger:* ${formData.name}%0A` +
        ` *Contact:* ${formData.phone}%0A` +
        ` *Route:* ${formData.from}  ${formData.to}%0A` +
        ` *Date:* ${formattedDate}%0A` +
        ` *Service:* ${formData.bus}%0A` +
        ` *Seat Price:* LKR ${seatPrice.toLocaleString()}%0A` +
        ` *Seats:* ${formData.seats} seat${formData.seats > 1 ? 's' : ''}%0A` +
        ` *Total Cost:* LKR ${totalCost.toLocaleString()}%0A%0A` +
        ` *Payment Instructions:*%0A` +
        `Bank: ${bankDetails.bankName}%0A` +
        `Account: ${bankDetails.accountName}%0A` +
        `Account No: ${bankDetails.accountNumber}%0A` +
        `Branch: ${bankDetails.branch}%0A` +
        `Reference: ${formData.name} - ${formData.phone}%0A%0A` +
        ` *Payment Slip:* Please attach payment confirmation%0A` +
        ` *Boarding:* Arrive 15 minutes before departure%0A` +
        `_Submitted via Lagan Bus Booking System_`;
}

function resetBookingForm() {
    const bookingForm = document.getElementById('bookingForm');
    if (bookingForm) {
        bookingForm.reset();
    }
    
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    const dateInput = document.getElementById('travelDate');
    if (dateInput) {
        dateInput.value = tomorrow.toISOString().split('T')[0];
    }
    
    updateTotalCostDisplay();
}

function openWhatsAppWithMessage(message) {
    const whatsappUrl = `https://wa.me/${ADMIN_WHATSAPP_NUMBER}?text=${message}`;
    const newWindow = window.open(whatsappUrl, '_blank');
    
    if (!newWindow) {
        showToast('Please allow popups to open WhatsApp', 'warning');
        Swal.fire({
            title: 'Copy WhatsApp Message',
            html: `<p>If WhatsApp didn't open automatically, copy this URL:</p>
                   <input type="text" value="${whatsappUrl}" readonly style="width:100%; padding:10px; margin:10px 0;">`,
            confirmButtonText: 'OK',
            background: 'var(--card)',
            color: 'var(--text-primary)'
        });
    }
}

function showBookingSuccess(bookingId, totalCost, formData) {
    Swal.fire({
        icon: 'success',
        title: 'Booking Submitted!',
        html: `
            <div style="text-align: center;">
                <div style="font-size: 56px; color: #25D366; margin-bottom: 20px;">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <p style="color: var(--text-primary); font-weight: 700; margin-bottom: 12px; font-size: 1.2rem">
                    Booking submitted successfully!
                </p>
                <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 15px;">
                    Booking ID: <strong>${bookingId}</strong>
                </p>
                <p style="font-size: 1rem; color: var(--text-secondary); margin-bottom: 15px;">
                    Total Amount: <strong>LKR ${totalCost.toLocaleString()}</strong>
                </p>
                <div style="background: rgba(59, 130, 246, 0.1); padding: 12px; border-radius: 8px; margin: 15px 0; font-size: 0.9rem;">
                    <strong>Next:</strong> Complete payment and attach slip on WhatsApp
                </div>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                     <strong>Remember:</strong> Arrive 15 minutes before departure at pickup point
                </p>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                    Our team will confirm once payment is verified
                </p>
            </div>
        `,
        timer: 5000,
        showConfirmButton: false,
        background: 'var(--card)',
        color: 'var(--text-primary)',
        backdrop: 'rgba(0, 0, 0, 0.3)'
    }).then(() => {
        switchTab('checkTab');
        const checkPhoneInput = document.getElementById('checkPhone');
        if (checkPhoneInput) {
            checkPhoneInput.value = formData.phone;
            setTimeout(() => {
                checkBooking();
            }, 500);
        }
    });
}

// ============ BANK DETAILS FUNCTIONS ============
async function showBankDetailsModal() {
    const busSelect = document.getElementById('busName');
    const seatSelect = document.getElementById('seatCount');
    const selectedBus = busSelect?.value;
    const selectedSeats = parseInt(seatSelect?.value) || 0;
    
    if (!selectedBus || !selectedSeats) {
        showToast('Please select both bus service and number of seats to see payment details.', 'warning');
        return;
    }
    
    const seatPrice = busPrices[selectedBus] || 0;
    const totalCost = seatPrice * selectedSeats;
    
    await Swal.fire({
        title: 'Secure Payment Details',
        html: createBankDetailsHTML(totalCost),
        width: window.innerWidth < 768 ? '95vw' : '600px',
        background: 'var(--card)',
        color: 'var(--text-primary)',
        confirmButtonText: 'Close',
        confirmButtonColor: 'var(--primary)',
        showCloseButton: true,
        didOpen: () => {
            window.bankDetailsText = createBankDetailsText(totalCost);
        }
    });
}

function createBankDetailsHTML(totalCost) {
    return `
        <div style="text-align: left; font-size: 0.95rem;">
            <p style="text-align: center; color: var(--primary); font-weight: 700; margin-bottom: 1.5rem; font-size: 1.1rem;">
                Please transfer exactly <strong>LKR ${totalCost.toLocaleString()}</strong> to:
            </p>
            
            <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid var(--secondary);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: var(--secondary); font-weight: 700;">Bank Account Information</h4>
                    <button type="button" onclick="copyAllBankDetails()" class="copy-all-btn" style="padding: 8px 16px; font-size: 0.85rem; background: var(--gradient-primary); color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
                        <i class="fas fa-copy"></i> Copy All
                    </button>
                </div>
                
                ${createBankDetailsFields()}
            </div>
            
            <div style="background: rgba(245, 158, 11, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid #F59E0B; margin-bottom: 15px;">
                <p style="color: var(--warning); font-weight: 600; margin-bottom: 8px;">
                    <i class="fas fa-lightbulb"></i> Important Instructions:
                </p>
                <div style="color: var(--text-primary); font-size: 0.9rem; line-height: 1.5;">
                    <p style="margin-bottom: 5px;">
                         Transfer the <strong>exact amount</strong> shown above
                    </p>
                    <p style="margin-bottom: 5px;">
                         Use <strong>Your Name + Phone Number</strong> as reference
                    </p>
                    <p>
                         Attach payment slip to WhatsApp message after booking
                    </p>
                </div>
            </div>
            
            <div style="background: rgba(216, 179, 93, 0.1); padding: 12px; border-radius: 8px; border-left: 4px solid var(--gold);">
                <p style="color: var(--gold); font-weight: 600; margin-bottom: 8px;">
                    <i class="fas fa-clock"></i> Boarding Reminder:
                </p>
                <div style="color: var(--text-primary); font-size: 0.9rem; line-height: 1.5;">
                    <p>
                        <strong>Arrive 15 minutes before departure</strong> at the pickup point with your booking confirmation.
                    </p>
                </div>
            </div>
        </div>
    `;
}

function createBankDetailsFields() {
    return `
        <div class="bank-details-container" id="bankDetailsContainer">
            <div class="copy-able-field" onclick="copyToClipboard('${bankDetails.bankName}', 'Bank Name')" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.2); cursor: pointer; transition: all 0.2s ease;">
                <span class="field-label" style="font-size: 0.9rem; font-weight: 600; color: var(--text-primary); min-width: 120px;">Bank Name</span>
                <span class="field-value" style="flex: 1; font-size: 0.95rem; font-weight: 700; color: var(--primary); text-align: right; word-break: break-all; padding: 0 10px;">${bankDetails.bankName}</span>
                <i class="copy-icon fas fa-copy" style="color: var(--gray); font-size: 0.9rem; transition: color 0.2s ease;"></i>
            </div>
            <div class="copy-able-field" onclick="copyToClipboard('${bankDetails.accountName}', 'Account Name')" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.2); cursor: pointer; transition: all 0.2s ease;">
                <span class="field-label" style="font-size: 0.9rem; font-weight: 600; color: var(--text-primary); min-width: 120px;">Account Name</span>
                <span class="field-value" style="flex: 1; font-size: 0.95rem; font-weight: 700; color: var(--primary); text-align: right; word-break: break-all; padding: 0 10px;">${bankDetails.accountName}</span>
                <i class="copy-icon fas fa-copy" style="color: var(--gray); font-size: 0.9rem; transition: color 0.2s ease;"></i>
            </div>
            <div class="copy-able-field" onclick="copyToClipboard('${bankDetails.accountNumber}', 'Account Number')" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.2); cursor: pointer; transition: all 0.2s ease;">
                <span class="field-label" style="font-size: 0.9rem; font-weight: 600; color: var(--text-primary); min-width: 120px;">Account Number</span>
                <span class="field-value" style="flex: 1; font-size: 0.95rem; font-weight: 700; color: var(--primary); text-align: right; word-break: break-all; padding: 0 10px;">${bankDetails.accountNumber}</span>
                <i class="copy-icon fas fa-copy" style="color: var(--gray); font-size: 0.9rem; transition: color 0.2s ease;"></i>
            </div>
            <div class="copy-able-field" onclick="copyToClipboard('${bankDetails.branch}', 'Branch')" style="display: flex; align-items: center; justify-content: space-between; padding: 10px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.2); cursor: pointer; transition: all 0.2s ease;">
                <span class="field-label" style="font-size: 0.9rem; font-weight: 600; color: var(--text-primary); min-width: 120px;">Branch</span>
                <span class="field-value" style="flex: 1; font-size: 0.95rem; font-weight: 700; color: var(--primary); text-align: right; word-break: break-all; padding: 0 10px;">${bankDetails.branch}</span>
                <i class="copy-icon fas fa-copy" style="color: var(--gray); font-size: 0.9rem; transition: color 0.2s ease;"></i>
            </div>
        </div>
    `;
}

function createBankDetailsText(totalCost) {
    return `Transfer Amount: LKR ${totalCost.toLocaleString()}
Bank: ${bankDetails.bankName}
Account Name: ${bankDetails.accountName}
Account Number: ${bankDetails.accountNumber}
Branch: ${bankDetails.branch}
Reference: Your Name + Phone Number
Important: Arrive 15 minutes before departure`;
}

async function copyToClipboard(text, label = '') {
    try {
        await navigator.clipboard.writeText(text);
        showCopySuccess(label);
    } catch (err) {
        console.error('Failed to copy: ', err);
        showToast('Copied to clipboard!', 'success');
    }
}

function showCopySuccess(label) {
    const message = document.createElement('div');
    message.className = 'copied-message';
    message.innerHTML = `<i class="fas fa-check-circle"></i> Copied: ${label}`;
    document.body.appendChild(message);
    
    setTimeout(() => {
        message.classList.add('show');
    }, 10);
    
    setTimeout(() => {
        message.classList.remove('show');
        setTimeout(() => {
            if (message.parentNode) {
                document.body.removeChild(message);
            }
        }, 300);
    }, 2000);
}

async function copyAllBankDetails() {
    if (window.bankDetailsText) {
        await copyToClipboard(window.bankDetailsText, 'All Bank Details');
    }
}

// ============ TICKET DOWNLOAD FUNCTIONS ============
async function downloadTicket() {
    if (!currentBookingData) {
        showToast('No booking data available', 'warning');
        vibrate();
        return;
    }
    
    const btn = document.getElementById('downloadTicketBtn');
    const originalText = btn ? btn.innerHTML : 'Download';
    if (btn) {
        btn.innerHTML = '<i class="fas fa-bus"></i> Generating...';
        btn.disabled = true;
    }
    
    showLoading('Generating ticket PDF...');
    
    try {
        await generatePDFTicket();
        showToast(' Ticket downloaded successfully!', 'success');
        vibrate('success');
        await saveTicketToDevice();
        
    } catch (error) {
        console.error('PDF Generation Error:', error);
        showToast('Using alternative method...', 'warning');
        await generateAlternativeTicket();
    } finally {
        if (btn) {
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
        hideLoading();
    }
}

async function generatePDFTicket() {
    return new Promise((resolve, reject) => {
        try {
            if (typeof window.jspdf === 'undefined') {
                reject(new Error('PDF library not loaded'));
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const ticketData = currentBookingData;
            
            const pdf = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [105, 148]
            });
            
            // Background with gradient
            pdf.setFillColor(11, 31, 58);
            pdf.rect(0, 0, 105, 148, 'F');
            
            // Golden header
            pdf.setFillColor(216, 179, 93);
            pdf.rect(0, 0, 105, 15, 'F');
            
            // Title
            pdf.setFont("helvetica", "bold");
            pdf.setTextColor(255, 255, 255);
            pdf.setFontSize(14);
            pdf.text("LAGAN BUS SERVICES", 52.5, 8, { align: 'center' });
            
            pdf.setFontSize(10);
            pdf.setTextColor(11, 31, 58);
            pdf.text("TRAVEL TICKET", 52.5, 13, { align: 'center' });
            
            // Passenger Info
            pdf.setFontSize(12);
            pdf.setTextColor(216, 179, 93);
            pdf.text("PASSENGER INFORMATION", 10, 25);
            
            pdf.setDrawColor(216, 179, 93);
            pdf.line(10, 27, 95, 27);
            
            pdf.setFontSize(10);
            pdf.setTextColor(255, 255, 255);
            pdf.text(`Name: ${ticketData.Name || 'Not Provided'}`, 10, 35);
            pdf.text(`Phone: ${ticketData.Phone || 'Not Provided'}`, 10, 40);
            pdf.text(`Booking ID: ${ticketData['Booking ID'] || 'Not Assigned'}`, 10, 45);
            
            // Journey Details
            pdf.setFontSize(12);
            pdf.setTextColor(216, 179, 93);
            pdf.text("JOURNEY DETAILS", 10, 55);
            pdf.line(10, 57, 95, 57);
            
            pdf.setFontSize(10);
            pdf.setTextColor(255, 255, 255);
            pdf.text(`Route: ${ticketData.Pickup || 'Not Specified'}  ${ticketData.Destination || 'Not Specified'}`, 10, 65);
            pdf.text(`Date: ${ticketData.Date || 'Not Specified'}`, 10, 70);
            pdf.text(`Time: ${ticketData.Time || 'Not Specified'}`, 10, 75);
            pdf.text(`Bus: ${ticketData.Bus || 'Not Assigned'}`, 10, 80);
            
            // Seat and Payment
            pdf.setFontSize(12);
            pdf.setTextColor(216, 179, 93);
            pdf.text("SEAT & PAYMENT", 10, 90);
            pdf.line(10, 92, 95, 92);
            
            pdf.setFontSize(10);
            pdf.setTextColor(255, 255, 255);
            
            // Format seat numbers for PDF
            const seatNumbers = formatSeatNumbersForPDF(ticketData['Seat Numbers']);
            pdf.text(`Seats: ${seatNumbers}`, 10, 100);
            pdf.text(`Seat Count: ${ticketData['Seat Count'] || '0'}`, 10, 105);
            pdf.text(`Amount per Seat: LKR ${parseInt(ticketData['Seat Amount'] || 0).toLocaleString()}`, 10, 110);
            pdf.text(`Total Amount: LKR ${parseInt(ticketData['Total Amount'] || 0).toLocaleString()}`, 10, 115);
            pdf.text(`Payment Status: ${ticketData['Payment Status'] || 'Payment Pending'}`, 10, 120);
            
            // Important Instructions
            pdf.setFontSize(9);
            pdf.setTextColor(216, 179, 93);
            pdf.text("IMPORTANT INSTRUCTIONS", 52.5, 130, { align: 'center' });
            
            pdf.setFontSize(8);
            pdf.setTextColor(255, 255, 255);
            const instructions = [
                " Arrive 15 minutes before departure at pickup point",
                " Keep this ticket and ID ready for verification",
                " Contact +94 701 362 527 for any assistance",
                " Boarding starts 10 minutes before departure",
                " Have a safe and pleasant journey!"
            ];
            
            instructions.forEach((instruction, index) => {
                pdf.text(instruction, 52.5, 135 + (index * 5), { align: 'center' });
            });
            
            // Footer
            pdf.setFontSize(7);
            pdf.setTextColor(216, 179, 93);
            pdf.text("Lagan Bus Services - Excellence in Motion", 52.5, 145, { align: 'center' });
            
            // Save the PDF
            const safeName = (ticketData.Name || 'Passenger').replace(/[^a-zA-Z0-9]/g, '_').substring(0, 20);
            const fileName = `LaganTicket_${safeName}_${ticketData['Booking ID'] || Date.now()}.pdf`;
            
            pdf.save(fileName);
            resolve();
            
        } catch (error) {
            console.error('PDF generation error:', error);
            reject(error);
        }
    });
}

function formatSeatNumbersForPDF(seatData) {
    if (!seatData || seatData === "" || seatData === "-" || seatData.toString().toLowerCase().includes("not updated")) {
        return "To be assigned";
    }
    
    const seatStr = seatData.toString().trim();
    let cleanSeatStr = seatStr.replace(/=$/, '').trim();
    
    let seats = [];
    
    if (cleanSeatStr.includes(',')) {
        seats = cleanSeatStr.split(',').map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes(';')) {
        seats = cleanSeatStr.split(';').map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes(' ')) {
        seats = cleanSeatStr.split(/\s+/).map(s => s.trim()).filter(s => s !== '');
    } else if (cleanSeatStr.includes('.')) {
        const parts = cleanSeatStr.split('.');
        seats = parts
            .map(part => {
                const num = parseInt(part.replace(/\D/g, ''));
                return isNaN(num) ? null : num;
            })
            .filter(num => num !== null && num > 0)
            .map(num => num.toString());
    } else {
        const num = parseInt(cleanSeatStr.replace(/\D/g, ''));
        if (!isNaN(num) && num > 0) {
            seats = [num.toString()];
        }
    }
    
    // Clean seat numbers (remove leading zeros)
    const cleanedSeats = seats.map(seat => {
        return seat.toString().replace(/^0+(\d)/, '$1');
    }).filter(seat => seat !== '');
    
    // Remove duplicates and sort
    const uniqueSortedSeats = [...new Set(cleanedSeats)]
        .map(s => parseInt(s))
        .sort((a, b) => a - b)
        .map(s => s.toString());
    
    return uniqueSortedSeats.join(', ') || "To be assigned";
}

async function generateAlternativeTicket() {
    return new Promise((resolve, reject) => {
        try {
            const ticketData = currentBookingData;
            if (!ticketData) {
                reject(new Error('No ticket data'));
                return;
            }
            
            const ticketHTML = createPrintableTicketHTML(ticketData);
            const printWindow = window.open('', '_blank', 'width=800,height=600');
            printWindow.document.write(ticketHTML);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.focus();
                printWindow.print();
                resolve();
            }, 1000);
            
        } catch (error) {
            console.error('Alternative ticket error:', error);
            reject(error);
        }
    });
}

function createPrintableTicketHTML(ticketData) {
    const seatNumbers = formatSeatNumbersForPDF(ticketData['Seat Numbers']);
    
    return `
    <!DOCTYPE html>
    <html>
    <head>
        <title>Lagan Bus Ticket - ${ticketData.Name || 'Passenger'}</title>
        <style>
            @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
            body {
                font-family: 'Inter', sans-serif;
                margin: 0;
                padding: 20px;
                background: linear-gradient(135deg, #0b1f3a 0%, #1f3e72 100%);
                color: white;
            }
            .ticket-container {
                max-width: 600px;
                margin: 0 auto;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 20px;
                padding: 30px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(216, 179, 93, 0.3);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            }
            .ticket-header {
                text-align: center;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #d8b35d;
            }
            .ticket-header h1 {
                color: #d8b35d;
                font-size: 28px;
                margin-bottom: 5px;
            }
            .ticket-header h2 {
                color: white;
                font-size: 18px;
                font-weight: 400;
            }
            .section {
                margin-bottom: 25px;
                padding: 15px;
                background: rgba(255, 255, 255, 0.05);
                border-radius: 10px;
                border-left: 4px solid #d8b35d;
            }
            .section h3 {
                color: #d8b35d;
                margin-top: 0;
                margin-bottom: 15px;
                font-size: 18px;
            }
            .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
            .info-item {
                margin-bottom: 10px;
            }
            .label {
                font-size: 12px;
                color: rgba(255, 255, 255, 0.7);
                text-transform: uppercase;
                letter-spacing: 1px;
                margin-bottom: 5px;
            }
            .value {
                font-size: 16px;
                font-weight: 600;
                color: white;
            }
            .instructions {
                background: rgba(245, 158, 11, 0.1);
                border: 1px solid rgba(245, 158, 11, 0.3);
                border-radius: 10px;
                padding: 20px;
                margin-top: 20px;
            }
            .instructions h4 {
                color: #f59e0b;
                margin-top: 0;
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .qr-code {
                text-align: center;
                margin: 30px 0;
                padding: 20px;
                background: white;
                border-radius: 10px;
                display: inline-block;
            }
            .footer {
                text-align: center;
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                font-size: 12px;
                color: rgba(255, 255, 255, 0.6);
            }
            @media print {
                body {
                    background: white;
                    color: black;
                }
                .ticket-container {
                    background: white;
                    color: black;
                    border: 2px solid #0b1f3a;
                }
                .section {
                    background: white;
                    border-left: 4px solid #0b1f3a;
                }
                .section h3, .ticket-header h1 {
                    color: #0b1f3a;
                }
                .value {
                    color: black;
                }
                .instructions {
                    border: 2px solid #f59e0b;
                }
            }
        </style>
    </head>
    <body>
        <div class="ticket-container">
            <div class="ticket-header">
                <h1>LAGAN BUS SERVICES</h1>
                <h2>TRAVEL TICKET</h2>
                <p>Booking ID: ${ticketData['Booking ID'] || 'N/A'}</p>
            </div>
            
            <div class="section">
                <h3>Passenger Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="label">Full Name</div>
                        <div class="value">${ticketData.Name || 'Not Provided'}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Phone Number</div>
                        <div class="value">${ticketData.Phone || 'Not Provided'}</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Journey Details</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="label">Route</div>
                        <div class="value">${ticketData.Pickup || 'Not Specified'}  ${ticketData.Destination || 'Not Specified'}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Date & Time</div>
                        <div class="value">${ticketData.Date || 'Not Specified'} ${ticketData.Time || ''}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Bus Service</div>
                        <div class="value">${ticketData.Bus || 'Not Assigned'}</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Seat & Payment</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="label">Seat Numbers</div>
                        <div class="value">${seatNumbers}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Seat Count</div>
                        <div class="value">${ticketData['Seat Count'] || '0'}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Amount per Seat</div>
                        <div class="value">LKR ${parseInt(ticketData['Seat Amount'] || 0).toLocaleString()}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Total Amount</div>
                        <div class="value">LKR ${parseInt(ticketData['Total Amount'] || 0).toLocaleString()}</div>
                    </div>
                    <div class="info-item">
                        <div class="label">Payment Status</div>
                        <div class="value" style="color: ${ticketData['Payment Status'] === 'Paid' ? '#10B981' : '#F59E0B'}">
                            ${ticketData['Payment Status'] || 'Payment Pending'}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="instructions">
                <h4><i class="fas fa-clock"></i> Important Instructions</h4>
                <ul style="margin: 10px 0; padding-left: 20px;">
                    <li>Arrive <strong>15 minutes before departure</strong> at the pickup point</li>
                    <li>Keep this ticket and valid ID ready for verification</li>
                    <li>Boarding starts 10 minutes before scheduled departure</li>
                    <li>Contact +94 701 362 527 for any assistance</li>
                    <li>Have a safe and pleasant journey!</li>
                </ul>
            </div>
            
            <div class="footer">
                <p>Lagan Bus Services - Excellence in Motion</p>
                <p>Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}</p>
            </div>
        </div>
    </body>
    </html>
    `;
}

async function saveTicketToDevice() {
    try {
        if (!currentBookingData) return;
        
        const ticketData = {
            ...currentBookingData,
            downloadTimestamp: new Date().toISOString(),
            source: 'Lagan Bus Booking System'
        };
        
        const savedTickets = JSON.parse(localStorage.getItem('laganSavedTickets') || '[]');
        const existingIndex = savedTickets.findIndex(t => 
            t['Booking ID'] === ticketData['Booking ID']
        );
        
        if (existingIndex >= 0) {
            savedTickets[existingIndex] = ticketData;
        } else {
            savedTickets.push(ticketData);
        }
        
        if (savedTickets.length > 20) {
            savedTickets.splice(0, savedTickets.length - 20);
        }
        
        localStorage.setItem('laganSavedTickets', JSON.stringify(savedTickets));
        sessionStorage.setItem('lastDownloadedTicket', JSON.stringify(ticketData));
        
        console.log(' Ticket saved to device storage');
        
    } catch (error) {
        console.error('Error saving ticket:', error);
    }
}

// ============ UTILITY FUNCTIONS ============
function showLoading(message = 'Processing...') {
    if (isLoading) return;
    
    isLoading = true;
    const loadingOverlay = document.getElementById('loadingOverlay');
    const loadingText = document.getElementById('loadingText');
    
    if (loadingOverlay && loadingText) {
        loadingText.textContent = message;
        loadingOverlay.classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    const buttons = ['checkBtn', 'whatsappSubmitBtn', 'downloadTicketBtn'];
    buttons.forEach(id => {
        const btn = document.getElementById(id);
        if (btn) {
            btn.disabled = true;
            btn.style.opacity = '0.7';
            btn.style.cursor = 'not-allowed';
        }
    });
}

function hideLoading() {
    isLoading = false;
    const loadingOverlay = document.getElementById('loadingOverlay');
    if (loadingOverlay) {
        loadingOverlay.classList.remove('active');
        document.body.style.overflow = '';
    }
    
    const buttons = ['checkBtn', 'whatsappSubmitBtn', 'downloadTicketBtn'];
    buttons.forEach(id => {
        const btn = document.getElementById(id);
        if (btn) {
            btn.disabled = false;
            btn.style.opacity = '1';
            btn.style.cursor = 'pointer';
        }
    });
}

function showToast(message, type = 'info') {
    try {
        const toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 4000,
            timerProgressBar: true,
            background: 'var(--card)',
            color: 'var(--text-primary)',
            backdrop: 'transparent',
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });
        
        const icon = type === 'success' ? 'success' : 
                     type === 'error' ? 'error' : 
                     type === 'warning' ? 'warning' : 'info';
        
        toast.fire({
            icon,
            title: message
        });
    } catch (e) {
        console.error('Toast error:', e);
        alert(message);
    }
}

function vibrate(type = 'error') {
    if ('vibrate' in navigator) {
        try {
            if (type === 'success') {
                navigator.vibrate([50, 50, 50]);
            } else {
                navigator.vibrate(100);
            }
        } catch (e) {
            // Silent fail
        }
    }
}

function openAdminWhatsApp() {
    const message = "Hello Lagan Bus Services, I need assistance with bus booking";
    const whatsappUrl = `https://wa.me/${ADMIN_WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
    window.open(whatsappUrl, '_blank');
}

function openWedoxaWebsite() {
    try {
        window.open(WEDOXA_WEBSITE, '_blank', 'noopener,noreferrer');
    } catch (error) {
        console.error('Error opening website:', error);
    }
}

// ============ GLOBAL EXPORTS ============
window.openAdminWhatsApp = openAdminWhatsApp;
window.switchTab = switchTab;
window.toggleSupportPanel = toggleSupportPanel;
window.copyToClipboard = copyToClipboard;
window.copyAllBankDetails = copyAllBankDetails;
window.openWedoxaWebsite = openWedoxaWebsite;

// ============ ERROR HANDLING ============
window.addEventListener('beforeunload', () => {
    if (isLoading) {
        hideLoading();
    }
});

window.addEventListener('error', (event) => {
    console.error('Unhandled error:', event.error);
    showToast('An error occurred. Please refresh the page.', 'error');
});

window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    showToast('An error occurred. Please try again.', 'error');
});

console.log(' Lagan Bus Booking System Ready');
</script>
</body>
</html>
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Lagan Bus Booking ‚Äî Check Your Seat</title>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
/* ===================== BASE STYLES ===================== */
:root {
  --primary-blue: #3a7bd5;
  --secondary-blue: #67b8f7;
  --dark-blue: #1a5cb0;
  --light-blue: #e8f4ff;
  --accent-gold: #ffd700;
  --accent-orange: #ff8c00;
  --text-primary: #0b2638;
  --text-secondary: #66788A;
  --text-muted: #8b9aad;
  --bg-light: #f8fafc;
  --bg-card: #ffffff;
  --border-light: #e2e8f0;
  --success: #10b981;
  --success-light: #d1fae5;
  --danger: #ef4444;
  --danger-light: #fee2e2;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.08);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --gradient-primary: linear-gradient(135deg, #3a7bd5, #67b8f7);
  --gradient-success: linear-gradient(135deg, #10b981, #34d399);
}

[data-theme="dark"] {
  --primary-blue: #5a8bff;
  --secondary-blue: #7ba6ff;
  --dark-blue: #88b8ff;
  --light-blue: #1e293b;
  --accent-gold: #ffed4e;
  --accent-orange: #ffa726;
  --text-primary: #f1f5f9;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --bg-light: #0f172a;
  --bg-card: #1e293b;
  --border-light: #334155;
  --success: #34d399;
  --success-light: #065f46;
  --danger: #f87171;
  --danger-light: #7f1d1d;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.25);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.35);
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
body { background: var(--bg-light); color: var(--text-primary); min-height: 100vh; transition: background-color 0.3s ease, color 0.3s ease; line-height: 1.5; }

/* Container */
.container { max-width: 1100px; margin: 0 auto; padding: 12px 18px 40px; }

/* Sky */
.sky-container {
  position: relative; width: 100%; height: 150px; border-radius: var(--radius-lg) var(--radius-lg) 0 0; margin-bottom: 6px; overflow: hidden; display:flex; align-items:center; justify-content:center;
}
[data-theme="light"] .sky-container { background: linear-gradient(180deg,#1e90ff 0%,#87ceeb 25%,#b0e2ff 50%,#e0f7ff 75%,#f0f8ff 100%); }
[data-theme="dark"] .sky-container { background: linear-gradient(180deg,#0a1a3a 0%,#1a2b5a 25%,#2a3c7a 50%,#3a4d9a 75%,#4a5eba 100%); }

/* Sun / Moon */
.sun-container { position:absolute; left:40px; top:100px; transition: all 1s cubic-bezier(0.34,1.56,0.64,1); z-index:10; }
.sun-risen .sun-container { top:22px; }
.sun-main { width:56px; height:56px; border-radius:50%; background: radial-gradient(circle at 30% 30%, #FFD700 0%, #FF8C00 30%, #FF4500 60%, #FF6347 100%); box-shadow: 0 0 40px rgba(255,215,0,0.8); animation: sunPulse 4s ease-in-out infinite; position:relative; }
.sun-glow { position:absolute; width:200%; height:200%; top:-50%; left:-50%; border-radius:50%; background: radial-gradient(circle, rgba(255,215,0,0.18) 0%, rgba(255,140,0,0.08) 40%, transparent 70%); animation: sunGlow 6s ease-in-out infinite; }
@keyframes sunPulse { 0%,100%{transform:scale(1)}50%{transform:scale(1.05)} }
@keyframes sunGlow { 0%,100%{opacity:0.5;transform:scale(1)}50%{opacity:0.8;transform:scale(1.08)} }
[data-theme="dark"] .sun-container { opacity:0; transform: translateY(80px) scale(0.6); }

.moon-container { position:absolute; right:40px; top:100px; transition: all 1s cubic-bezier(0.34,1.56,0.64,1); opacity:0; z-index:10; }
.moon-risen .moon-container { top:24px; opacity:1; }
.moon-main { width:50px; height:50px; border-radius:50%; background: radial-gradient(circle at 70% 30%, #F8F8FF 0%, #E6E6FA 30%, #D8BFD8 60%, #DDA0DD 100%); box-shadow:0 0 30px rgba(248,248,255,0.8); animation: moonGlow 6s ease-in-out infinite; position:relative; overflow:hidden; }
.moon-craters{position:absolute;width:100%;height:100%;border-radius:50%}
.moon-crater{position:absolute;border-radius:50%;background:rgba(0,0,0,0.15);box-shadow:inset 1px 1px 4px rgba(0,0,0,0.18)}
.moon-crater.large{width:12px;height:12px;top:12px;left:12px}
.moon-crater.medium{width:9px;height:9px;top:32px;right:12px}
.moon-crater.small{width:5px;height:5px;bottom:18px;left:20px}
.moon-glow{position:absolute;width:200%;height:200%;top:-50%;left:-50%;border-radius:50%;background:radial-gradient(circle,rgba(248,248,255,0.12)0%,rgba(230,230,250,0.06)40%,transparent70%);animation:moonHalo 8s ease-in-out infinite}
@keyframes moonGlow{0%,100%{transform:scale(1)}50%{transform:scale(1.03)}}
@keyframes moonHalo{0%,100%{opacity:0.28;transform:scale(1)}50%{opacity:0.48;transform:scale(1.04)}}
[data-theme="light"] .moon-container { opacity:0; transform: translateY(80px) scale(0.6); }

/* Clouds & stars (kept compact) */
.day-clouds{position:absolute;width:100%;height:100%;opacity:1;transition:opacity 1s;z-index:5}
[data-theme="dark"] .day-clouds{opacity:0}
.cloud-left,.cloud-right{position:absolute;width:40%;height:100%}
.cloud{position:absolute;background:rgba(255,255,255,0.95);border-radius:50%;filter:blur(1px);opacity:0.95}
.left-cloud-1{width:78px;height:24px;top:30px;left:30px;animation:cloudFloat1 70s linear infinite}
.left-cloud-2{width:68px;height:22px;top:75px;left:55px;animation:cloudFloat2 78s linear infinite 12s}
.left-cloud-3{width:58px;height:20px;top:118px;left:85px;animation:cloudFloat3 85s linear infinite 28s}
.right-cloud-1{width:75px;height:25px;top:40px;right:40px;animation:cloudFloat2 65s linear infinite 5s}
.right-cloud-2{width:65px;height:22px;top:90px;right:70px;animation:cloudFloat1 75s linear infinite 20s}
.right-cloud-3{width:55px;height:20px;top:130px;right:100px;animation:cloudFloat3 95s linear infinite 35s}
@keyframes cloudFloat1{0%{transform:translateX(-200px)}100%{transform:translateX(calc(100vw + 200px))}}
@keyframes cloudFloat2{0%{transform:translateX(calc(100vw + 200px))}100%{transform:translateX(-200px)}}
@keyframes cloudFloat3{0%{transform:translateX(-150px) translateY(0)}50%{transform:translateX(calc(50vw - 75px)) translateY(-10px)}100%{transform:translateX(calc(100vw + 150px)) translateY(0)}}
.stars-container{position:absolute;width:100%;height:100%;opacity:0;transition:opacity 1.2s ease;z-index:2}
[data-theme="dark"] .stars-container{opacity:1}
.star{position:absolute;background:white;border-radius:50%;animation:starTwinkle var(--twinkle-duration) infinite var(--twinkle-delay)}
.star.small{width:1px;height:1px;--twinkle-duration:2s;box-shadow:0 0 2px white}
.star.medium{width:2px;height=2px;--twinkle-duration:3s;box-shadow:0 0 3px white,0 0 5px rgba(255,255,255,0.5)}
.star.large{width:3px;height=3px;--twinkle-duration:4s;box-shadow:0 0 4px white,0 0 8px rgba(255,255,255,0.5)}
@keyframes starTwinkle{0%,100%{opacity:0.2;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}}

/* Header */
.main-header{ text-align:center; margin-top:0; margin-bottom:14px; padding:16px 20px; background: var(--bg-card); border-radius:0 0 var(--radius-lg) var(--radius-lg); box-shadow: var(--shadow-md); border: 1px solid var(--border-light); position: relative; overflow: hidden; }
.main-header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary-blue), var(--secondary-blue), var(--accent-orange)); }
.brand { font-size: 1.9rem; font-weight: 900; background: linear-gradient(135deg, var(--dark-blue), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 8px; display: flex; align-items: center; justify-content: center; gap: 10px; letter-spacing: 0.5px; }
.tagline { font-size: 1rem; color: var(--text-secondary); margin-bottom: 10px; font-weight: 500; }
.contact-info { display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, rgba(58, 123, 213, 0.1), rgba(255, 140, 0, 0.1)); padding: 10px 20px; border-radius: 50px; font-weight: 700; color: var(--dark-blue); border: 2px solid rgba(58, 123, 213, 0.2); font-size: 0.95rem; backdrop-filter: blur(10px); }
[data-theme="dark"] .contact-info { background: linear-gradient(135deg, rgba(88, 139, 255, 0.15), rgba(255, 167, 38, 0.1)); }

/* Theme toggle - floating bottom-right */
.theme-toggle-container { position: fixed; bottom: 18px; right: 18px; z-index: 1000; display: flex; flex-direction: column; align-items: center; gap: 10px; }
.theme-btn { background: var(--bg-card); border: 2px solid var(--border-light); color: var(--text-primary); padding: 10px 16px; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: all 0.25s; box-shadow: var(--shadow-md); display: flex; align-items: center; gap: 8px; white-space: nowrap; backdrop-filter: blur(10px); }
.theme-btn:hover { transform: translateY(-2px) scale(1.05); box-shadow: var(--shadow-lg); border-color: var(--primary-blue); background: var(--gradient-primary); color: white; }

/* Layout */
.main-content { display: grid; grid-template-columns: 420px 1fr; gap: 24px; margin-top: 12px; margin-bottom: 12px; align-items: start; }
@media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }

/* Cards */
.search-card { background: var(--bg-card); border-radius: var(--radius-lg); padding: 24px; box-shadow: var(--shadow-lg); border: 1px solid var(--border-light); position: sticky; top: 16px; backdrop-filter: blur(10px); }
.card-title { font-size: 1.3rem; font-weight: 800; color: var(--dark-blue); margin-bottom: 16px; display: flex; align-items: center; gap: 10px; padding-bottom: 10px; border-bottom: 2px solid var(--border-light); }
.input-group { margin-bottom: 16px; }
.input-label { display: block; margin-bottom: 8px; font-weight: 700; color: var(--text-secondary); font-size: 0.95rem; }
.input-field { width: 100%; padding: 14px 16px; border-radius: var(--radius-md); border: 2px solid var(--border-light); background: var(--bg-light); color: var(--text-primary); font-size: 1rem; transition: all 0.3s; }
.input-field:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 4px rgba(58, 123, 213, 0.15); background: var(--bg-card); transform: translateY(-1px); }
.search-btn { width: 100%; padding: 14px; background: var(--gradient-primary); color: white; border: none; border-radius: var(--radius-md); font-size: 1.05rem; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 8px; transition: all 0.3s; box-shadow: 0 4px 12px rgba(58, 123, 213, 0.25); }
.search-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(58, 123, 213, 0.35); }
.search-btn:active { transform: translateY(0); }
.search-btn:disabled { opacity: 0.7; cursor: not-allowed; transform: none !important; box-shadow: none; }

/* Results */
.results-card { background: var(--bg-card); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); border: 1px solid var(--border-light); overflow: hidden; min-height: 320px; display: flex; flex-direction: column; }
.results-header { background: var(--gradient-primary); color: white; padding: 20px; text-align: center; position: relative; }
.results-header::after { content: ''; position: absolute; bottom: -8px; left: 0; right: 0; height: 16px; background: radial-gradient(circle at 10px 0, white 6px, transparent 7px) 0 0 / 20px 16px; }
.results-title { font-size: 1.5rem; font-weight: 900; margin-bottom: 6px; }
.results-subtitle { font-size: 0.95rem; opacity: 0.9; }
.results-body { padding: 20px; flex: 1; display: flex; flex-direction: column; justify-content: flex-start; }

/* No results */
.no-results { text-align: center; color: var(--text-muted); font-size: 1rem; padding: 40px 20px; }
.no-results-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.6; }
.no-results-title { font-size: 1.2rem; margin-bottom: 10px; color: var(--text-secondary); }

/* Ticket */
.ticket-info { display: grid; grid-template-columns: repeat(2, 1fr); gap: 14px; margin-bottom: 20px; }
@media (max-width: 768px) { .ticket-info { grid-template-columns: 1fr; } }
.info-card { background: var(--bg-light); padding: 16px; border-radius: var(--radius-md); border: 1px solid var(--border-light); transition: all 0.3s; }
.info-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); border-color: var(--primary-blue); }
.info-label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.8px; margin-bottom: 8px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
.info-value { font-size: 1.1rem; font-weight: 800; color: var(--text-primary); line-height: 1.4; }
#passengerName { font-size: 1.3rem; color: var(--dark-blue); font-weight: 900; padding-bottom: 10px; margin-bottom: 10px; text-align: center; background: linear-gradient(135deg, var(--dark-blue), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

/* Time slot special styling */
.time-slot-card { grid-column: span 2; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 140, 0, 0.05)); border: 2px dashed rgba(255, 140, 0, 0.3); }
@media (max-width: 768px) { .time-slot-card { grid-column: span 1; } }
.time-slot-card .info-value { color: var(--accent-orange); font-size: 1.2rem; }
.time-slot-card .info-label { color: var(--accent-orange); }

/* Seats */
.seats-section { background: linear-gradient(135deg, rgba(58, 123, 213, 0.06), rgba(103, 184, 247, 0.03)); padding: 20px; border-radius: var(--radius-md); border: 2px dashed var(--border-light); margin-bottom: 16px; }
.section-title { font-size: 1.1rem; font-weight: 800; color: var(--dark-blue); margin-bottom: 16px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 10px; }
.seats-container { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
.seat { width: 70px; height: 70px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue)); color: white; font-weight: 900; border: 3px solid var(--bg-card); box-shadow: var(--shadow-md); transition: all 0.3s; position: relative; overflow: hidden; }
.seat::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: rgba(255, 255, 255, 0.4); }
.seat:hover { transform: scale(1.1) rotate(5deg); box-shadow: 0 8px 25px rgba(58, 123, 213, 0.4); }
.seat-icon { font-size: 20px; margin-bottom: 6px; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); }
.seat-number { font-size: 1.1rem; }
.no-seats { text-align: center; color: var(--text-muted); font-style: italic; padding: 16px; background: var(--bg-light); border-radius: var(--radius-md); border: 2px dashed var(--border-light); }

/* Download */
.download-section { margin-top: 16px; text-align: center; }
.download-btn { display: inline-flex; align-items: center; gap: 10px; padding: 12px 24px; background: var(--gradient-success); color: white; border: none; border-radius: var(--radius-md); font-size: 1rem; font-weight: 800; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25); }
.download-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(16, 185, 129, 0.35); background: linear-gradient(135deg, #34d399, #059669); }

/* Feedback */
.feedback-section { margin-top: 16px; padding: 16px; background: var(--bg-light); border-radius: var(--radius-md); border: 1px solid var(--border-light); text-align: center; }
.feedback-title { font-size: 1rem; font-weight: 800; color: var(--dark-blue); margin-bottom: 12px; }
.feedback-buttons { display: flex; gap: 12px; justify-content: center; }
.feedback-btn { padding: 10px 20px; border-radius: var(--radius-md); border: 2px solid var(--border-light); background: var(--bg-card); color: var(--text-primary); font-weight: 700; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 140px; }
.feedback-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
.feedback-btn.yes:hover { background: var(--success-light); border-color: var(--success); color: var(--success); }
.feedback-btn.no:hover { background: var(--danger-light); border-color: var(--danger); color: var(--danger); }

/* Footer */
.main-footer { text-align: center; padding: 16px; color: var(--text-muted); font-size: 0.95rem; border-top: 1px solid var(--border-light); margin-top: 20px; }
.company-name { font-weight: 900; color: var(--primary-blue); letter-spacing: 0.5px; background: linear-gradient(135deg, var(--primary-blue), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }

/* Spinner */
.spinner { display: inline-block; width: 20px; height: 20px; border: 3px solid rgba(255, 255, 255, 0.3); border-radius: 50%; border-top-color: white; animation: spin 1s linear infinite; }
@keyframes spin { to { transform: rotate(360deg); } }

/* Animations */
.fade-in { animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

.pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

@media (max-width: 768px) {
  .container { padding: 8px 14px 30px; }
  .sky-container { height: 120px; }
  .sun-container { left: 26px; top: 80px; }
  .sun-main { width: 48px; height: 48px; }
  .moon-container { right: 26px; top: 80px; }
  .moon-main { width: 44px; height: 44px; }
  .main-header { padding: 14px 16px; margin-bottom: 14px; }
  .brand { font-size: 1.5rem; }
  .search-card { padding: 20px; position: static; }
  .ticket-info { grid-template-columns: 1fr; gap: 12px; }
  #passengerName { font-size: 1.2rem; }
  .seats-section { padding: 16px; }
  .seat { width: 60px; height: 60px; }
  .theme-btn { padding: 8px 14px; font-size: 0.85rem; }
  .feedback-buttons { flex-direction: column; }
  .feedback-btn { width: 100%; }
}

@media (max-width: 480px) {
  .brand { font-size: 1.3rem; }
  .sky-container { height: 100px; }
  .sun-container { left: 18px; top: 70px; }
  .sun-main { width: 40px; height: 40px; }
  .moon-container { right: 18px; top: 70px; }
  .moon-main { width: 38px; height: 38px; }
  .theme-toggle-container { bottom: 12px; right: 12px; }
}
</style>
</head>
<body>
<div class="container">

  <!-- Sky -->
  <div class="sky-container" id="skyContainer" aria-hidden="true">
    <div class="sun-container" aria-hidden="true"><div class="sun-main"><div class="sun-glow"></div></div></div>
    <div class="moon-container" aria-hidden="true"><div class="moon-main"><div class="moon-craters"><div class="moon-crater large"></div><div class="moon-crater medium"></div><div class="moon-crater small"></div></div><div class="moon-glow"></div></div></div>
    <div class="day-clouds" aria-hidden="true">
      <div class="cloud-left"><div class="cloud left-cloud-1"></div><div class="cloud left-cloud-2"></div><div class="cloud left-cloud-3"></div></div>
      <div class="cloud-right"><div class="cloud right-cloud-1"></div><div class="cloud right-cloud-2"></div><div class="cloud right-cloud-3"></div></div>
    </div>
    <div class="stars-container" id="starsContainer" aria-hidden="true"></div>
  </div>

  <!-- Header -->
  <header class="main-header" role="banner" aria-label="Site header">
    <h1 class="brand">Welcome To Lagan Bus Booking</h1>
    <p class="tagline">Safe Travels. May God Bless Your Journey.</p>
    <div class="contact-info">üìû For Reservations: <strong>0777 402 886 (Mr. Fawas)</strong></div>
  </header>

  <!-- Theme Toggle -->
  <div class="theme-toggle-container" aria-hidden="true">
    <button class="theme-btn" id="themeToggle" aria-pressed="false" title="Toggle theme">
      <span id="themeIcon">üåô</span>
      <span id="themeText">Dark Mode</span>
    </button>
  </div>

  <!-- Main -->
  <main class="main-content" role="main">

    <!-- Search Card -->
    <div class="search-card" role="region" aria-label="Check Booking">
      <h2 class="card-title">üîç Check Your Booking</h2>

      <div class="input-group">
        <label class="input-label" for="phone">Phone Number</label>
        <input type="tel" id="phone" class="input-field" placeholder="Enter 10-digit number (077XXXXXXX)" maxlength="10" inputmode="tel" aria-label="Phone number">
      </div>

      <button id="searchBtn" class="search-btn" aria-label="Check my booking">
        <span>üîç</span> Check My Booking
      </button>

      <div style="margin-top:16px">
        <p style="font-weight:700;color:var(--dark-blue);margin-bottom:8px;">üìù Instructions:</p>
        <p style="font-size:0.88rem;color:var(--text-secondary);">
          1. Enter the phone number used for booking (with or without leading 0)<br>
          2. Click "Check My Booking"<br>
          3. View your seat details & download ticket
        </p>
      </div>
    </div>

    <!-- Results Card -->
    <div class="results-card" role="region" aria-label="Booking details">
      <div class="results-header">
        <h2 class="results-title">Your Booking Details</h2>
        <p class="results-subtitle">Find all your travel information here</p>
      </div>

      <div class="results-body" id="resultsBody">
        <div class="no-results" aria-live="polite">
          <div class="no-results-icon">üöå</div>
          <h3 class="no-results-title">No Booking Found</h3>
          <p>Enter your phone number to check your booking details</p>
        </div>

        <div id="bookingDetails" style="display:none;">
          <div class="info-card" style="grid-column:1 / -1; text-align:center;">
            <div class="info-label"><span>üë§</span> Passenger Name</div>
            <div id="passengerName" class="info-value">-</div>
          </div>

          <div class="ticket-info">
            <div class="info-card"><div class="info-label"><span>üöå</span> Bus Name</div><div id="busName" class="info-value">-</div></div>
            <div class="info-card"><div class="info-label"><span>üìÖ</span> Date</div><div id="travelDate" class="info-value">-</div></div>
            <div class="info-card time-slot-card"><div class="info-label"><span>‚è∞</span> Time Slot</div><div id="timeSlot" class="info-value">-</div></div>
            <div class="info-card"><div class="info-label"><span>üìç</span> Pickup Location</div><div id="pickupLocation" class="info-value">-</div></div>
            <div class="info-card"><div class="info-label"><span>üí∞</span> Payment Status</div><div id="paymentAmount" class="info-value">-</div></div>
            <div class="info-card"><div class="info-label"><span>üÜî</span> Booking ID</div><div id="bookingId" class="info-value">-</div></div>
          </div>

          <div class="seats-section">
            <h3 class="section-title"><span>üí∫</span> Your Seat Numbers</h3>
            <div class="seats-container" id="seatsBox" aria-live="polite"></div>
          </div>

          <div class="download-section">
            <button id="downloadBtn" class="download-btn"><span>üé´</span> Download Ticket</button>
          </div>

          <div id="feedbackSection" class="feedback-section" style="display:none;">
            <h3 class="feedback-title">Did you receive your correct seat information?</h3>
            <div class="feedback-buttons">
              <button class="feedback-btn yes" id="fbYes"><span>üëç</span> Yes, All Good</button>
              <button class="feedback-btn no" id="fbNo"><span>üëé</span> No, Issue Found</button>
            </div>
          </div>

        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="main-footer" role="contentinfo">
    <p>Made with <span style="color:#e74c3c;">‚ù§</span> by <span class="company-name">WEDOXA</span></p>
  </footer>

</div>

<script>
// ===================== CONFIG =====================
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwtADuWek0zWGZROj4HRsS_h-WRjhMRMCShOmaAxnReTULgHHiFPA-hEDQa2v6iQYPPnA/exec";

// ===================== UI INIT =====================
document.addEventListener('DOMContentLoaded', function() {
  const savedTheme = localStorage.getItem('lagan-theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  updateThemeUI(savedTheme);
  createStars();

  // animate sun/moon
  setTimeout(() => {
    if (savedTheme === 'light') document.body.classList.add('sun-risen');
    else { document.body.classList.add('moon-risen'); createShootingStars(); }
  }, 300);

  document.getElementById('themeToggle').addEventListener('click', function() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    if (newTheme === 'dark') {
      document.body.classList.remove('sun-risen');
      setTimeout(() => {
        document.documentElement.setAttribute('data-theme', newTheme);
        updateThemeUI(newTheme);
        localStorage.setItem('lagan-theme', newTheme);
        setTimeout(() => { document.body.classList.add('moon-risen'); createShootingStars(); }, 200);
      }, 200);
    } else {
      document.body.classList.remove('moon-risen');
      setTimeout(() => {
        document.documentElement.setAttribute('data-theme', newTheme);
        updateThemeUI(newTheme);
        localStorage.setItem('lagan-theme', newTheme);
        setTimeout(() => { document.body.classList.add('sun-risen'); }, 200);
      }, 200);
    }
  });

  const phoneInput = document.getElementById('phone');
  phoneInput.addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.length > 10) value = value.substring(0, 10);
    e.target.value = value;
  });
  phoneInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') searchBooking(); });

  document.getElementById('searchBtn').addEventListener('click', searchBooking);
  document.getElementById('downloadBtn').addEventListener('click', downloadTicket);
  document.getElementById('fbYes').addEventListener('click', ()=> sendFeedback('Yes'));
  document.getElementById('fbNo').addEventListener('click', ()=> sendFeedback('No'));
});

function updateThemeUI(theme) {
  const themeIcon = document.getElementById('themeIcon');
  const themeText = document.getElementById('themeText');
  const toggleBtn = document.getElementById('themeToggle');
  if (theme === 'dark') { themeIcon.textContent = '‚òÄÔ∏è'; themeText.textContent = 'Light Mode'; toggleBtn.setAttribute('aria-pressed','true'); }
  else { themeIcon.textContent = 'üåô'; themeText.textContent = 'Dark Mode'; toggleBtn.setAttribute('aria-pressed','false'); }
}

function createStars() {
  const container = document.getElementById('starsContainer');
  if (!container) return;
  container.innerHTML = '';
  for (let i=0;i<100;i++){
    const star = document.createElement('div');
    star.classList.add('star');
    const s = Math.random();
    if (s<0.6) star.classList.add('small');
    else if (s<0.9) star.classList.add('medium');
    else star.classList.add('large');
    star.style.left = `${Math.random()*100}%`;
    star.style.top = `${Math.random()*100}%`;
    const delay = Math.random()*4;
    star.style.setProperty('--twinkle-delay', `${delay}s`);
    container.appendChild(star);
  }
}

function createShootingStars() {
  const container = document.getElementById('starsContainer');
  if (!container) return;
  function createShootingStar() {
    if (document.documentElement.getAttribute('data-theme') !== 'dark') return;
    const shootingStar = document.createElement('div');
    shootingStar.style.cssText = `position:absolute;width:60px;height:1px;background:linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,1) 30%, rgba(255,255,255,0) 100%);opacity:0;transform:rotate(-45deg);z-index:25;`;
    const startX = Math.random()*80 + 10;
    const startY = Math.random()*30;
    shootingStar.style.left = `${startX}%`;
    shootingStar.style.top = `${startY}%`;
    container.appendChild(shootingStar);
    const duration = Math.random()*800 + 400;
    shootingStar.animate([
      { transform:'translateX(0) translateY(0) rotate(-45deg)', opacity:0 },
      { transform:'translateX(200px) translateY(100px) rotate(-45deg)', opacity:1 },
      { transform:'translateX(400px) translateY(200px) rotate(-45deg)', opacity:0 }
    ], { duration: duration, easing: 'cubic-bezier(0.4,0,0.2,1)'});
    setTimeout(()=>{ if(shootingStar.parentNode) shootingStar.parentNode.removeChild(shootingStar); }, duration);
  }
  setInterval(()=>{ if (document.documentElement.getAttribute('data-theme') === 'dark' && Math.random()<0.18) createShootingStar(); }, 3000);
}

// ===================== HELPERS =====================

function normalizePhoneForQuery(raw) {
  if (!raw) return '';
  let digits = String(raw).replace(/\D/g, '');
  if (digits.length === 10 && digits.startsWith('0')) digits = digits.substring(1);
  return digits;
}

// ===================== TIME PARSING FUNCTIONS =====================
function parseTimeSlot(timeValue) {
  if (!timeValue) return '';
  
  const timeStr = String(timeValue).trim().toLowerCase();
  
  // Check for common time patterns
  if (timeStr.includes('am') || timeStr.includes('pm')) {
    // Try to parse AM/PM format
    const timeMatch = timeStr.match(/(\d{1,2})(?::(\d{2}))?\s*(am|pm)/i);
    if (timeMatch) {
      let hours = parseInt(timeMatch[1], 10);
      const minutes = timeMatch[2] ? timeMatch[2] : '00';
      const ampm = timeMatch[3].toUpperCase();
      
      // Convert to 24-hour for validation
      if (ampm === 'PM' && hours < 12) hours += 12;
      if (ampm === 'AM' && hours === 12) hours = 0;
      
      return `${timeMatch[1]}:${minutes} ${ampm}`;
    }
  }
  
  // Check for 24-hour format
  const time24Match = timeStr.match(/(\d{1,2}):(\d{2})/);
  if (time24Match) {
    let hours = parseInt(time24Match[1], 10);
    const minutes = time24Match[2];
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    return `${hours}:${minutes} ${ampm}`;
  }
  
  // Check for numbers only (like 730 for 7:30)
  const numOnly = timeStr.match(/^(\d{3,4})$/);
  if (numOnly) {
    const num = numOnly[1];
    let hours, minutes;
    if (num.length === 3) {
      hours = num.substring(0, 1);
      minutes = num.substring(1, 3);
    } else {
      hours = num.substring(0, 2);
      minutes = num.substring(2, 4);
    }
    const hourNum = parseInt(hours, 10);
    const minNum = parseInt(minutes, 10);
    if (hourNum >= 0 && hourNum <= 24 && minNum >= 0 && minNum <= 59) {
      const ampm = hourNum >= 12 ? 'PM' : 'AM';
      const displayHour = hourNum % 12 || 12;
      return `${displayHour}:${minutes.padStart(2, '0')} ${ampm}`;
    }
  }
  
  // Return original if no pattern matches
  return timeValue;
}

function parseDate(dateValue) {
  if (!dateValue) return '';
  
  const dateStr = String(dateValue).trim();
  
  // Try parsing as Date object first
  const dateObj = new Date(dateValue);
  if (!isNaN(dateObj.getTime())) {
    const options = { day: 'numeric', month: 'short', year: 'numeric' };
    return dateObj.toLocaleDateString('en-GB', options);
  }
  
  // Try parsing common formats
  const formats = [
    // DD/MM/YYYY
    /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
    // MM/DD/YYYY
    /^(\d{1,2})\/(\d{1,2})\/(\d{4})$/,
    // YYYY-MM-DD
    /^(\d{4})-(\d{1,2})-(\d{1,2})$/,
    // DD-MM-YYYY
    /^(\d{1,2})-(\d{1,2})-(\d{4})$/
  ];
  
  const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  
  for (const format of formats) {
    const match = dateStr.match(format);
    if (match) {
      let day, month, year;
      
      if (format.toString().includes('YYYY-MM-DD')) {
        year = match[1];
        month = match[2];
        day = match[3];
      } else if (format.toString().includes('YYYY')) {
        // Assume last part is year
        year = match[3];
        month = match[2];
        day = match[1];
      } else {
        // Try to determine format by value
        const part1 = parseInt(match[1], 10);
        const part2 = parseInt(match[2], 10);
        if (part1 > 12) {
          // First part is day
          day = part1;
          month = part2;
        } else if (part2 > 12) {
          // Second part is day
          day = part2;
          month = part1;
        } else {
          // Ambiguous, assume DD/MM
          day = part1;
          month = part2;
        }
        year = match[3];
      }
      
      const monthIndex = parseInt(month, 10) - 1;
      if (monthIndex >= 0 && monthIndex < 12) {
        return `${day} ${months[monthIndex]} ${year}`;
      }
    }
  }
  
  // Return original if no format matches
  return dateValue;
}

// ===================== SEARCH =====================

function searchBooking() {
  let phoneRaw = document.getElementById('phone').value.trim();
  const btn = document.getElementById('searchBtn');

  const phone = normalizePhoneForQuery(phoneRaw);

  if (!phone || phone.length < 9) {
    Swal.fire({ icon:'warning', title:'Enter Phone Number', text:'Please enter a valid phone number (9-10 digits)', confirmButtonColor:'#3a7bd5' });
    return;
  }

  btn.innerHTML = '<div class="spinner"></div> Searching...';
  btn.disabled = true;

  Swal.fire({ title:'Finding your booking...', allowOutsideClick:false, didOpen: () => Swal.showLoading() });

  fetch(`${SCRIPT_URL}?phone=${encodeURIComponent(phone)}`)
    .then(res => res.json())
    .then(data => {
      btn.innerHTML = '<span>üîç</span> Check My Booking';
      btn.disabled = false;
      Swal.close();

      if (!data || !data.success || !data.booking) {
        const msg = (data && data.message) ? data.message : 'We could not find a booking with this phone number';
        Swal.fire({ icon:'error', title:'No Booking Found', text: msg, confirmButtonColor:'#3a7bd5' });
        document.getElementById('bookingDetails').style.display = 'none';
        document.getElementById('feedbackSection').style.display = 'none';
        const nr = document.getElementById('resultsBody').querySelector('.no-results');
        if (nr) nr.style.display = 'block';
        return;
      }

      renderBooking(data.booking);

      const resultsCard = document.querySelector('.results-card');
      if (resultsCard) resultsCard.scrollIntoView({ behavior:'smooth', block:'center' });
    })
    .catch(err => {
      btn.innerHTML = '<span>üîç</span> Check My Booking';
      btn.disabled = false;
      Swal.close();
      Swal.fire({ icon:'error', title:'Connection Error', text:'Please check your internet connection and try again', confirmButtonColor:'#3a7bd5' });
      console.error('Fetch error:', err);
    });
}

// ===================== RENDER BOOKING =====================
function renderBooking(b) {
  try {
    if (!b || typeof b !== 'object') throw new Error('Invalid booking object');

    // Function to get field with multiple possible names
    function getField(obj, possibleNames) {
      if (!obj) return null;
      
      // First try exact matches
      for (const name of possibleNames) {
        if (obj[name] !== undefined) return obj[name];
      }
      
      // Try case-insensitive matches
      const lowerNames = possibleNames.map(n => n.toLowerCase());
      for (const key in obj) {
        if (obj.hasOwnProperty(key)) {
          const lowerKey = key.toLowerCase().replace(/[^a-z0-9]/g, '');
          if (lowerNames.some(n => lowerKey.includes(n.replace(/[^a-z0-9]/g, '')))) {
            return obj[key];
          }
        }
      }
      
      return null;
    }

    // Extract fields with comprehensive name options
    const name = getField(b, ['Name', 'Passenger', 'PassengerName', 'Passenger Name', 'Full Name', 'Customer Name', 'CustomerName']) || '-';
    const bus = getField(b, ['Bus', 'BusName', 'Bus Name', 'Vehicle', 'BusNumber', 'Service', 'Bus Type']) || '-';
    const dateRaw = getField(b, ['Date', 'TravelDate', 'Travel Date', 'JourneyDate', 'DepartureDate', 'Date of Travel', 'TravelDate']) || '';
    const timeRaw = getField(b, ['Time', 'TimeSlot', 'Time Slot', 'DepartureTime', 'Departure Time', 'Time of Departure']) || '';
    const seat = getField(b, ['Seat', 'Seats', 'SeatNumber', 'Seat Number', 'SeatNumbers', 'Seat No', 'SeatNo']) || '';
    const pickup = getField(b, ['Pickup', 'PickupLocation', 'Pickup Location', 'Boarding Point', 'PickupPoint', 'BoardingPoint']) || '-';
    const payment = getField(b, ['Payment', 'Amount', 'PaymentStatus', 'Fare', 'Price', 'Total', 'Payment Amount']) || '-';
    const bookingId = getField(b, ['BookingID', 'Booking ID', 'Reference', 'RefNo', 'Ticket No', 'TicketNo', 'BookingRef']) || '';

    // Apply formatting
    document.getElementById('passengerName').textContent = String(name);
    document.getElementById('busName').textContent = String(bus);
    document.getElementById('travelDate').textContent = parseDate(dateRaw);
    document.getElementById('timeSlot').textContent = parseTimeSlot(timeRaw);
    document.getElementById('pickupLocation').textContent = String(pickup);
    document.getElementById('paymentAmount').textContent = String(payment);
    document.getElementById('bookingId').textContent = bookingId ? String(bookingId) : 'Not Assigned';

    // Handle seats display
    const seatsBox = document.getElementById('seatsBox');
    seatsBox.innerHTML = '';
    
    if (seat && String(seat).trim() !== '' && 
        String(seat).trim().toLowerCase() !== 'not updated' && 
        String(seat).trim().toLowerCase() !== 'n/a' &&
        String(seat).trim() !== '-' &&
        String(seat).trim() !== 'null') {
      
      const seatStr = String(seat);
      // Split by common separators
      const seats = seatStr.split(/[,;\-\/|]+/).map(s => s.trim()).filter(s => s !== '' && s !== '-');
      
      if (seats.length > 0) {
        seats.forEach(seatNum => {
          const seatElement = document.createElement('div');
          seatElement.className = 'seat';
          seatElement.innerHTML = `<div class="seat-icon">üí∫</div><div class="seat-number">${seatNum}</div>`;
          seatsBox.appendChild(seatElement);
        });
      } else {
        seatsBox.innerHTML = '<div class="no-seats">No seat assigned yet. Please contact Mr. Fawas.</div>';
      }
    } else {
      seatsBox.innerHTML = '<div class="no-seats">No seat assigned yet. Please contact Mr. Fawas.</div>';
    }

    // Show booking details
    document.getElementById('bookingDetails').style.display = 'block';
    document.getElementById('feedbackSection').style.display = 'block';
    const nr = document.getElementById('resultsBody').querySelector('.no-results');
    if (nr) nr.style.display = 'none';

    // Add animation
    const bookingDetails = document.getElementById('bookingDetails');
    bookingDetails.classList.remove('fade-in');
    setTimeout(() => bookingDetails.classList.add('fade-in'), 10);

    // Store data for download
    window.currentBookingData = {
      passengerName: name,
      busName: bus,
      travelDate: parseDate(dateRaw),
      timeSlot: parseTimeSlot(timeRaw),
      pickupLocation: pickup,
      paymentAmount: payment,
      seats: seat,
      bookingId: bookingId
    };

  } catch (err) {
    console.error('renderBooking error:', err);
    Swal.fire({ icon:'error', title:'Display Error', text:'Unable to show booking details. Please contact admin.', confirmButtonColor:'#3a7bd5' });
    document.getElementById('bookingDetails').style.display = 'none';
    document.getElementById('feedbackSection').style.display = 'none';
    const nr = document.getElementById('resultsBody').querySelector('.no-results');
    if (nr) nr.style.display = 'block';
  }
}

// ===================== DOWNLOAD TICKET =====================
function escapeHtml(unsafe) {
  if (unsafe === null || unsafe === undefined) return '';
  return String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

function downloadTicket() {
  const data = window.currentBookingData;
  if (!data) {
    Swal.fire({ icon:'warning', title:'No Booking Data', text:'Please search for a booking first', confirmButtonColor:'#3a7bd5' });
    return;
  }

  const downloadBtn = document.getElementById('downloadBtn');
  const originalText = downloadBtn.innerHTML;
  downloadBtn.innerHTML = '<div class="spinner"></div> Preparing...';
  downloadBtn.disabled = true;

  const safeFileName = `Lagan-Ticket-${String(data.passengerName).replace(/[^a-z0-9]/gi,'-') || 'ticket'}.html`;

  // Build ticket HTML
  const ticketHtml = `
<!DOCTYPE html><html><head><meta charset="utf-8"><title>Lagan Bus Ticket - ${escapeHtml(data.passengerName)}</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
body { background: #f5f7fa; padding: 20px; }
.ticket { max-width: 800px; margin: 0 auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 2px solid #3a7bd5; }
.ticket-header { background: linear-gradient(135deg, #3a7bd5, #67b8f7, #ff8c00); color: white; padding: 25px; text-align: center; }
.ticket-title { font-size: 24px; font-weight: 900; margin-bottom: 8px; }
.ticket-subtitle { font-size: 14px; opacity: 0.9; }
.ticket-body { padding: 25px; }
.passenger-name { text-align: center; font-size: 22px; font-weight: 900; color: #1a5cb0; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px dashed #e2e8f0; }
.info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 25px; }
.info-card { background: #f8fafc; padding: 18px; border-radius: 10px; border: 1px solid #e2e8f0; }
.info-label { font-size: 12px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 700; }
.info-value { font-size: 16px; font-weight: 800; color: #0f172a; }
.time-slot-card { background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,140,0,0.05)); border: 2px dashed rgba(255,140,0,0.4); }
.time-slot-card .info-value { color: #ff8c00; font-size: 18px; }
.seats-section { background: linear-gradient(135deg, rgba(58,123,213,0.08), rgba(103,184,247,0.04)); padding: 20px; border-radius: 12px; border: 2px dashed #dbeafe; margin-bottom: 25px; }
.section-title { font-size: 18px; font-weight: 800; color: #1a5cb0; margin-bottom: 16px; text-align: center; }
.seats-container { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; }
.seat { width: 65px; height: 65px; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg,#3a7bd5,#1a5cb0); color: white; font-weight: 900; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.contact-info { text-align: center; margin-top: 20px; padding: 16px; background: #f0f9ff; border-radius: 10px; border: 1px solid #bae6fd; }
.ticket-footer { text-align: center; padding: 16px; color: #64748b; font-size: 14px; border-top: 1px solid #e2e8f0; background: #f8fafc; }
@media print { body { background: white; padding: 0; } .ticket { box-shadow: none; border: 2px solid #3a7bd5; } }
</style>
</head><body>
  <div class="ticket">
    <div class="ticket-header">
      <h1 class="ticket-title">LAGAN BUS TICKET</h1>
      <p class="ticket-subtitle">Safe Travels. May God Bless Your Journey.</p>
    </div>
    <div class="ticket-body">
      <div class="passenger-name">${escapeHtml(data.passengerName)}</div>
      <div class="info-grid">
        <div class="info-card"><div class="info-label">Bus Name</div><div class="info-value">${escapeHtml(data.busName)}</div></div>
        <div class="info-card"><div class="info-label">Travel Date</div><div class="info-value">${escapeHtml(data.travelDate)}</div></div>
        <div class="info-card time-slot-card"><div class="info-label">Time Slot</div><div class="info-value">${escapeHtml(data.timeSlot)}</div></div>
        <div class="info-card"><div class="info-label">Pickup Location</div><div class="info-value">${escapeHtml(data.pickupLocation)}</div></div>
        <div class="info-card"><div class="info-label">Payment Status</div><div class="info-value">${escapeHtml(data.paymentAmount)}</div></div>
        <div class="info-card"><div class="info-label">Booking ID</div><div class="info-value">${escapeHtml(data.bookingId)}</div></div>
      </div>
      <div class="seats-section">
        <h3 class="section-title">SEAT NUMBERS</h3>
        <div class="seats-container">
          ${data.seats && String(data.seats).trim() !== '' && 
            String(data.seats).trim().toLowerCase() !== 'not updated' &&
            String(data.seats).trim().toLowerCase() !== 'n/a' ?
            String(data.seats).split(/[,;\-\/|]+/).filter(s => s.trim() !== '').map(s => 
              `<div class="seat"><div style="font-size:12px">üí∫</div><div>${escapeHtml(s.trim())}</div></div>`
            ).join('') :
            '<div style="text-align:center;color:#64748b;font-style:italic;padding:20px;">No seat assigned yet</div>'
          }
        </div>
      </div>
      <div class="contact-info">
        <p style="font-weight:800;color:#0369a1;margin-bottom:8px;font-size:16px;">üìû CONTACT INFORMATION</p>
        <p style="color:#475569;font-size:15px;">For inquiries & assistance, contact:</p>
        <p style="font-weight:900;color:#1a5cb0;font-size:18px;margin-top:8px;">Mr. Fawas - 0777 402 886</p>
      </div>
    </div>
    <div class="ticket-footer">
      <p>Ticket generated on ${new Date().toLocaleDateString('en-GB', { day:'numeric', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' })}</p>
      <p style="margin-top:8px;font-weight:700;">Made with ‚ù§ by WEDOXA</p>
    </div>
  </div>
</body></html>
  `;

  const blob = new Blob([ticketHtml], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = safeFileName;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  setTimeout(() => { 
    downloadBtn.innerHTML = originalText; 
    downloadBtn.disabled = false; 
    downloadBtn.classList.add('pulse');
    setTimeout(() => downloadBtn.classList.remove('pulse'), 2000);
  }, 700);

  Swal.fire({ 
    icon: 'success', 
    title: 'Ticket Downloaded!', 
    text: 'Your ticket has been saved to your device', 
    confirmButtonColor: '#3a7bd5', 
    timer: 1500, 
    showConfirmButton: false 
  });
}

// ===================== FEEDBACK =====================
function sendFeedback(answer) {
  const phoneRaw = document.getElementById('phone').value.trim();
  if (!phoneRaw) {
    Swal.fire({ icon:'warning', title:'Enter Phone Number', text:'Please search first', confirmButtonColor:'#3a7bd5' });
    return;
  }

  const phone = normalizePhoneForQuery(phoneRaw);

  fetch(`${SCRIPT_URL}?action=feedback&phone=${encodeURIComponent(phone)}&answer=${encodeURIComponent(answer)}`)
    .then(r => r.json())
    .then(resp => {
      if (resp && resp.success) {
        Swal.fire({ icon:'success', title:'Thanks for your feedback!', timer:1200, showConfirmButton:false });
      } else {
        Swal.fire({ icon:'error', title:'Unable to send feedback', text: (resp && resp.message) ? resp.message : 'Try again later', confirmButtonColor:'#3a7bd5' });
      }
    }).catch(err => {
      console.error('feedback error', err);
      Swal.fire({ icon:'error', title:'Connection Error', text:'Could not send feedback right now', confirmButtonColor:'#3a7bd5' });
    });
}
</script>
</body>
</html>